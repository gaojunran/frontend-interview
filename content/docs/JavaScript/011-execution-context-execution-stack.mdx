---
title: JavaScript中执行上下文和执行栈是什么？
---

在 JavaScript 中，**执行上下文（Execution Context）** 和 **执行栈（Execution Stack）** 是理解代码运行机制的核心概念，尤其与作用域、变量查找、函数调用等紧密相关。下面分别解释它们的含义和关系：

---

## 一、执行上下文（Execution Context）

### 1. 定义：

执行上下文是 JavaScript 代码被解析和执行时的运行环境。每当函数被调用或全局代码执行时，都会创建一个执行上下文。

### 2. 分类：

JavaScript 中有三种执行上下文：

* **全局执行上下文（Global Execution Context）**

  * 页面加载时默认创建，只有一个。
  * 在浏览器中就是 `window` 对象（或在 Node.js 中是 `global`）。
* **函数执行上下文（Function Execution Context）**

  * 每次函数被调用时都会创建一个新的执行上下文。
* **eval 执行上下文**

  * 很少使用，`eval()` 内部的代码也会创建自己的上下文。

### 3. 执行上下文包含的内容：

执行上下文会生成一个执行上下文对象，主要包含以下三个部分：

| 组件                             | 说明                                |
| ------------------------------ | --------------------------------- |
| **变量环境（Variable Environment）** | 包含变量声明（`var`）、函数声明、函数参数。用于变量的初始化。 |
| **词法环境（Lexical Environment）**  | 包含变量、函数的引用关系（作用域链）。               |
| **this 绑定**                    | 指向当前执行环境下的 `this` 值。              |

---

## 二、执行栈（Execution Stack）也叫调用栈（Call Stack）

### 1. 定义：

执行栈是一种\*\*后进先出（LIFO）\*\*的数据结构，用来管理执行上下文。

### 2. 执行流程：

1. **程序开始运行时**，将**全局执行上下文**压入执行栈。
2. **当函数被调用时**，为该函数创建一个新的执行上下文并压入栈顶。
3. **函数执行完毕后**，该上下文从栈中弹出，控制权交还给上一个上下文。
4. **栈清空后**，程序运行结束。

### 3. 示例说明：

```js
function foo() {
  console.log('foo');
  bar();
}

function bar() {
  console.log('bar');
}

foo();
```

### 对应的执行栈变化如下：

```
调用 foo()
-> 创建 foo 上下文，压入栈顶
-> 执行 foo 中 console.log（输出 foo）
-> 调用 bar()
   -> 创建 bar 上下文，压入栈顶
   -> 执行 bar 中 console.log（输出 bar）
   -> bar 上下文弹出
-> foo 执行结束，上下文弹出
-> 栈为空，程序结束
```

---

## 三、总结

| 概念    | 说明                          |
| ----- | --------------------------- |
| 执行上下文 | 每段代码运行时的环境，决定了变量、函数的可访问性。   |
| 执行栈   | 管理执行上下文的栈结构，确保函数按正确顺序执行和退出。 |

---

如果你想进一步理解，比如如何与**闭包**、**作用域链**关联，可以继续深入探讨这些概念。是否需要我接着讲讲？
