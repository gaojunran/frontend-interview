---
title: è®²ä¸€ä¸‹ Proxyï¼Ÿ
---

åœ¨ JavaScript ä¸­ï¼Œ`Proxy` æ˜¯ ES6 å¼•å…¥çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ç”¨æ¥**æ‹¦æˆªå¹¶è‡ªå®šä¹‰å¯¹è±¡çš„åŸºæœ¬æ“ä½œ**ï¼Œå¦‚å±æ€§çš„è¯»å–ã€èµ‹å€¼ã€åˆ é™¤ã€å‡½æ•°è°ƒç”¨ç­‰ã€‚ç®€å•æ¥è¯´ï¼Œ`Proxy` å°±æ˜¯åœ¨ç›®æ ‡å¯¹è±¡å’Œå¤–éƒ¨æ“ä½œä¹‹é—´æ¶äº†ä¸€å±‚â€œä»£ç†â€ã€‚

---

## ğŸ”§ åŸºæœ¬è¯­æ³•

```js
const proxy = new Proxy(target, handler);
```

* `target`ï¼šè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯å¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ç­‰ï¼‰
* `handler`ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œå®šä¹‰å„ç§æ“ä½œçš„æ•è·å™¨ï¼ˆtrapï¼‰

---

## ğŸ§² å¸¸è§ trapï¼ˆæ‹¦æˆªå™¨ï¼‰

```js
const handler = {
  get(target, prop, receiver) {
    // æ‹¦æˆªè¯»å–å±æ€§
  },
  set(target, prop, value, receiver) {
    // æ‹¦æˆªè®¾ç½®å±æ€§
  },
  has(target, prop) {
    // æ‹¦æˆª in æ“ä½œç¬¦
  },
  deleteProperty(target, prop) {
    // æ‹¦æˆª delete æ“ä½œ
  },
  ownKeys(target) {
    // æ‹¦æˆª Object.keys()ã€for...in
  },
  apply(target, thisArg, args) {
    // æ‹¦æˆªå‡½æ•°è°ƒç”¨
  },
  construct(target, args, newTarget) {
    // æ‹¦æˆª new æ“ä½œç¬¦
  }
}
```

---

## âœ… ç¤ºä¾‹ï¼šå±æ€§è®¿é—®æ‹¦æˆª

```js
const person = {
  name: 'Tom',
  age: 18
};

const proxy = new Proxy(person, {
  get(target, prop) {
    console.log(`è®¿é—®äº†å±æ€§ ${prop}`);
    return target[prop];
  },
  set(target, prop, value) {
    console.log(`è®¾ç½®å±æ€§ ${prop} ä¸º ${value}`);
    target[prop] = value;
    return true;
  }
});

proxy.name;          // è®¿é—®äº†å±æ€§ name -> 'Tom'
proxy.age = 20;      // è®¾ç½®å±æ€§ age ä¸º 20
```

---

## ğŸ§  ä½¿ç”¨åœºæ™¯

### 1. æ•°æ®éªŒè¯

```js
const user = new Proxy({}, {
  set(target, prop, value) {
    if (prop === 'age' && typeof value !== 'number') {
      throw new TypeError('age å¿…é¡»æ˜¯æ•°å­—');
    }
    target[prop] = value;
    return true;
  }
});

user.age = 25;  // OK
user.age = '25'; // æŠ›é”™
```

### 2. è‡ªåŠ¨å¡«å……é»˜è®¤å€¼

```js
const withDefault = new Proxy({}, {
  get: (target, prop) => prop in target ? target[prop] : 'é»˜è®¤å€¼'
});

console.log(withDefault.name); // é»˜è®¤å€¼
```

### 3. è§‚å¯Ÿæ•°æ®å˜åŒ–ï¼ˆå“åº”å¼ï¼ŒVue3 å°±ç”¨ Proxy å®ç°çš„å“åº”å¼ï¼‰

```js
function reactive(obj) {
  return new Proxy(obj, {
    get(target, prop) {
      console.log('è¯»å–å±æ€§ï¼š', prop);
      return Reflect.get(target, prop);
    },
    set(target, prop, value) {
      console.log('è®¾ç½®å±æ€§ï¼š', prop, '=', value);
      return Reflect.set(target, prop, value);
    }
  });
}

const state = reactive({ count: 0 });
state.count++;
```

---

## ğŸ§± `Reflect` çš„æ­é…ä½¿ç”¨

é€šå¸¸æˆ‘ä»¬ä¼šæ­é… [`Reflect`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect) æ¥å®Œæˆé»˜è®¤è¡Œä¸ºï¼Œç¡®ä¿è¡Œä¸ºä¸€è‡´æ€§ï¼š

```js
const proxy = new Proxy(obj, {
  get(target, prop, receiver) {
    return Reflect.get(target, prop, receiver);
  },
  set(target, prop, value, receiver) {
    return Reflect.set(target, prop, value, receiver);
  }
});
```

---

## ğŸš« æ³¨æ„äº‹é¡¹

* `Proxy` æ˜¯ä¸€å±‚**åŒ…è£…**ï¼Œä¸ä¼šä¿®æ”¹åŸå¯¹è±¡ï¼Œé™¤éä½ å¯¹åŸå¯¹è±¡ç›´æ¥æ“ä½œï¼›
* æœ‰äº›å†…å»ºæ“ä½œæ— æ³•è¢« Proxy æ‹¦æˆªï¼ˆå¦‚ `Object.defineProperty` ä¸­çš„æŸäº›è¡Œä¸ºï¼‰ï¼›
* `Proxy` ä¸å…¼å®¹ IEã€‚

