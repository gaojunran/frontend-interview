---
title: å¦‚ä½•åœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨ vitest è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Ÿ
---

> è¿™é‡Œæœ‰ä¸€ä¸ªè¯¦å°½çš„åœ¨ Vue é¡¹ç›®ä¸­æµ‹è¯•çš„å®˜æ–¹æ–‡æ¡£ï¼šhttps://vuejs.org/guide/scaling-up/testing

åœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨ [**Vitest**](https://vitest.dev/) è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œé€šå¸¸é€‚ç”¨äºåŸºäº Vite çš„é¡¹ç›®ï¼ˆå¦‚ Vueã€React é¡¹ç›®ï¼‰ã€‚Vitest æ˜¯ä¸€ä¸ª Vite åŸç”Ÿæ”¯æŒçš„æµ‹è¯•æ¡†æ¶ï¼Œå…·æœ‰å¿«é€Ÿã€è½»é‡ã€TypeScript å‹å¥½ç­‰ä¼˜ç‚¹ã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´çš„ä½¿ç”¨æµç¨‹å’Œå®è·µå»ºè®®ï¼š

---

## âœ… ä¸€ã€å®‰è£… Vitest ç›¸å…³ä¾èµ–

åœ¨ Vite é¡¹ç›®ä¸­å®‰è£… Vitestã€æµ‹è¯•åº“ï¼ˆå¦‚ `@testing-library`ï¼‰ï¼š

```bash
# åŸºç¡€ä¾èµ–
npm install -D vitest

# å¦‚æœä½ ä½¿ç”¨ Vue
npm install -D @vue/test-utils vue

# å¦‚æœä½ ä½¿ç”¨ React
npm install -D @testing-library/react jsdom

# é€šå¸¸ä¹Ÿéœ€è¦ jsdom æ¨¡æ‹Ÿ DOM ç¯å¢ƒ
npm install -D jsdom
```

---

## âœ… äºŒã€é…ç½® `vitest.config.ts`

è¿™æ˜¯ Vitest çš„é…ç½®æ–‡ä»¶ï¼Œä½äºé¡¹ç›®æ ¹ç›®å½•ï¼Œé€šå¸¸ä¸ `vite.config.ts` åˆå¹¶é…ç½®å³å¯ï¼š

```ts
// vitest.config.ts
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    globals: true, // ä½¿ç”¨ describe/test/expect ç­‰æ— éœ€å¼•å…¥
    environment: 'jsdom', // ç”¨äºæ¨¡æ‹Ÿ DOM ç¯å¢ƒï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰
    setupFiles: './test/setup.ts', // å¯é€‰ï¼šå…¨å±€è®¾ç½®æ–‡ä»¶è·¯å¾„
    coverage: {
      reporter: ['text', 'json', 'html'],
    },
  },
})
```

---

## âœ… ä¸‰ã€ç¼–å†™æµ‹è¯•æ–‡ä»¶

æµ‹è¯•æ–‡ä»¶å‘½åä¸€èˆ¬ä¸ºï¼š

* `xxx.test.ts` æˆ– `xxx.spec.ts`
* ä½äº `tests/` æˆ–ç»„ä»¶åŒçº§çš„ `__tests__/` ç›®å½•

### ğŸ“Œ ç¤ºä¾‹ï¼ˆVue ç»„ä»¶ï¼‰

```ts
// src/components/Hello.test.ts
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Hello from './Hello.vue'

describe('Hello.vue', () => {
  it('renders props', () => {
    const wrapper = mount(Hello, {
      props: {
        msg: 'Vitest',
      },
    })
    expect(wrapper.text()).toContain('Vitest')
  })
})
```

### ğŸ“Œ ç¤ºä¾‹ï¼ˆæ™®é€šå‡½æ•°ï¼‰

```ts
// src/utils/math.ts
export const add = (a: number, b: number) => a + b

// src/utils/math.test.ts
import { describe, it, expect } from 'vitest'
import { add } from './math'

describe('add', () => {
  it('adds two numbers', () => {
    expect(add(1, 2)).toBe(3)
  })
})
```

---

## âœ… å››ã€è¿è¡Œæµ‹è¯•

```bash
npx vitest
# æˆ– watch æ¨¡å¼
npx vitest --watch
```

ä½ ä¹Ÿå¯ä»¥åœ¨ `package.json` æ·»åŠ å¿«æ·è„šæœ¬ï¼š

```json
{
  "scripts": {
    "test": "vitest",
    "test:watch": "vitest --watch"
  }
}
```

---

## âœ… äº”ã€é›†æˆæµ‹è¯•è¦†ç›–ç‡ï¼ˆå¯é€‰ï¼‰

å¯ç”¨è¦†ç›–ç‡éœ€å®‰è£… `c8`ï¼š

```bash
npm install -D c8
```

é…ç½®å·²åœ¨ä¸Šé¢ `vitest.config.ts` ä¸­æåˆ°ï¼Œè¿è¡Œï¼š

```bash
npx vitest --coverage
```

---

## âœ… å…­ã€é¢å¤–å»ºè®®

* ä½¿ç”¨ `@testing-library/react` / `@testing-library/vue` æé«˜ç»„ä»¶æµ‹è¯•çš„å¯ç»´æŠ¤æ€§ã€‚
* å¯ç»“åˆ CI å·¥å…·ï¼ˆGitHub Actionsã€GitLab CIï¼‰è‡ªåŠ¨è¿è¡Œæµ‹è¯•ã€‚
* æ”¯æŒ mockã€spyã€hook æµ‹è¯•ç­‰é«˜çº§åŠŸèƒ½ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚



