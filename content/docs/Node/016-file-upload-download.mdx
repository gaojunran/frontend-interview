---
title: åœ¨ Node.js ä¸­å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ï¼Ÿ
---

åœ¨ Node.js ä¸­å¤„ç†æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½æ˜¯æ„å»º Web åº”ç”¨ç¨‹åºå¸¸è§çš„éœ€æ±‚ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯**è¯¦ç»†è®²è§£**ï¼š

---

## ğŸŸ¢ ä¸€ã€å¤„ç†æ–‡ä»¶ä¸Šä¼ 

Node.js æœ¬èº«æ²¡æœ‰å†…å»ºå¤„ç†ä¸Šä¼ çš„èƒ½åŠ›ï¼Œé€šå¸¸æˆ‘ä»¬å€ŸåŠ©ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ï¼š

### âœ… å¸¸ç”¨æ–¹å¼ï¼šä½¿ç”¨ `multer` ä¸­é—´ä»¶ï¼ˆåŸºäº Expressï¼‰

`multer` æ˜¯å¤„ç† `multipart/form-data` çš„ä¸­é—´ä»¶ï¼Œä¸»è¦ç”¨äºä¸Šä¼ æ–‡ä»¶ã€‚

### 1. å®‰è£…ä¾èµ–

```bash
npm install express multer
```

### 2. ç¤ºä¾‹ä»£ç 

```js
const express = require('express');
const multer  = require('multer');
const path = require('path');

// è®¾ç½®ä¸Šä¼ æ–‡ä»¶å­˜å‚¨ä½ç½®å’Œæ–‡ä»¶å
const storage = multer.diskStorage({
  destination: function (req, file, cb) {
    cb(null, 'uploads/'); // ä¸Šä¼ ç›®å½•
  },
  filename: function (req, file, cb) {
    cb(null, Date.now() + '-' + file.originalname); // é¿å…æ–‡ä»¶åå†²çª
  }
});

const upload = multer({ storage: storage });

const app = express();
const PORT = 3000;

// è¡¨å•ä¸Šä¼ å¤„ç†ï¼Œ'file' æ˜¯è¡¨å•å­—æ®µå
app.post('/upload', upload.single('file'), (req, res) => {
  res.send(`æ–‡ä»¶ ${req.file.originalname} ä¸Šä¼ æˆåŠŸï¼`);
});

// å¯åŠ¨æœåŠ¡å™¨
app.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});
```

### 3. å®¢æˆ·ç«¯ HTML ç¤ºä¾‹

```html
<form action="/upload" method="post" enctype="multipart/form-data">
  <input type="file" name="file" />
  <button type="submit">ä¸Šä¼ </button>
</form>
```

---

## ğŸ”» è¡¥å……ï¼šä¸Šä¼ å¤šä¸ªæ–‡ä»¶æˆ–å­—æ®µ

```js
// ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼ˆæœ€å¤š 5 ä¸ªï¼‰
app.post('/upload-multiple', upload.array('files', 5), (req, res) => {
  res.send(`${req.files.length} ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸ`);
});
```

---

## ğŸŸ¢ äºŒã€å¤„ç†æ–‡ä»¶ä¸‹è½½

Node.js å¯ä»¥ç”¨ Express éå¸¸ç®€å•åœ°å®ç°æ–‡ä»¶ä¸‹è½½ï¼š

### âœ… ä½¿ç”¨ `res.download()` æ–¹æ³•

```js
app.get('/download/:filename', (req, res) => {
  const filename = req.params.filename;
  const filepath = path.join(__dirname, 'uploads', filename);
  res.download(filepath, err => {
    if (err) {
      res.status(404).send('æ–‡ä»¶æœªæ‰¾åˆ°');
    }
  });
});
```

### å®¢æˆ·ç«¯ä¸‹è½½æ–¹å¼ï¼ˆç›´æ¥é“¾æ¥ï¼‰ï¼š

```html
<a href="/download/sample.txt">ä¸‹è½½æ–‡ä»¶</a>
```

---

## ğŸ“ æ–‡ä»¶å®‰å…¨æ³¨æ„äº‹é¡¹

* âœ… é™åˆ¶ä¸Šä¼ æ–‡ä»¶ç±»å‹ï¼ˆé€šè¿‡ `fileFilter`ï¼‰
* âœ… é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆé€šè¿‡ `limits.fileSize`ï¼‰
* âœ… é˜²æ­¢è·¯å¾„ç©¿è¶Šæ”»å‡»ï¼ˆsanitize æ–‡ä»¶åã€æ£€æŸ¥è·¯å¾„ï¼‰
* âœ… ä¸Šä¼ ç›®å½•è®¾ç½®è®¿é—®æƒé™ï¼ˆå¦‚ç§æœ‰ã€ä¸´æ—¶ï¼‰

---

## âœ³ï¸ ç¤ºä¾‹ï¼šé™åˆ¶ä¸Šä¼ å¤§å°å’Œç±»å‹

```js
const upload = multer({
  storage: storage,
  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB
  fileFilter: function (req, file, cb) {
    const allowed = ['image/jpeg', 'image/png'];
    if (!allowed.includes(file.mimetype)) {
      return cb(new Error('åªå…è®¸ä¸Šä¼  JPG æˆ– PNG å›¾ç‰‡'));
    }
    cb(null, true);
  }
});
```

---

## ğŸ§ª æµ‹è¯•å·¥å…·æ¨è

* Postmanï¼ˆç”¨äºæµ‹è¯•æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼‰
* curl ç¤ºä¾‹ï¼š

```bash
curl -F "file=@example.txt" http://localhost:3000/upload
```

---

## âœ… æ€»ç»“

| æ“ä½œ     | æ–¹æ³•/å·¥å…·                               |
| ------ | ----------------------------------- |
| æ–‡ä»¶ä¸Šä¼    | `multer` ä¸­é—´ä»¶ï¼Œé…åˆ Express             |
| å•ä¸ªæ–‡ä»¶ä¸Šä¼  | `upload.single('file')`             |
| å¤šä¸ªæ–‡ä»¶ä¸Šä¼  | `upload.array('files')`             |
| æ–‡ä»¶ä¸‹è½½   | `res.download()` æˆ– `res.sendFile()` |
| å®‰å…¨å¤„ç†   | æ–‡ä»¶ç±»å‹éªŒè¯ã€å¤§å°é™åˆ¶ã€è·¯å¾„æ ¡éªŒç­‰                   |

å¦‚æœä½ ä¸ä½¿ç”¨ Expressï¼Œè¿˜æœ‰å¦‚ `formidable`ã€`busboy` ç­‰å¯é€‰æ–¹æ¡ˆï¼Œæˆ‘ä¹Ÿå¯ä»¥è¡¥å……è¯´æ˜ã€‚

éœ€è¦æˆ‘ç»™ä½ ä¸€ä¸ªå®Œæ•´é¡¹ç›®æ¨¡æ¿å—ï¼Ÿ
