---
title: å¦‚ä½•åœ¨ Node.js ä¸­å®ç°çº³ç§’çº§åˆ«çš„é«˜ç²¾åº¦è®¡æ—¶ï¼Ÿ
---

åœ¨ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³å®ç°**çº³ç§’çº§åˆ«çš„é«˜ç²¾åº¦è®¡æ—¶**ï¼ˆé€šå¸¸ç”¨äºæ€§èƒ½åˆ†æã€åŸºå‡†æµ‹è¯•ç­‰åœºæ™¯ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Node.js å†…å»ºæ¨¡å— `process.hrtime()` æˆ– `performance.now()`ï¼ˆæ¥è‡ª `perf_hooks` æ¨¡å—ï¼‰ã€‚ä¸‹é¢è¯¦ç»†è®²è§£å®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å’Œå·®å¼‚ã€‚

---

## ä¸€ã€`process.hrtime()`ï¼šé«˜åˆ†è¾¨ç‡å®æ—¶æ—¶é—´

### âœ… ç‰¹ç‚¹

* è¿”å›çš„æ˜¯ä¸€ä¸ª **é«˜åˆ†è¾¨ç‡çš„æ—¶é—´å·®**ï¼ˆç›¸å¯¹äºä»»æ„å›ºå®šæ—¶é—´ç‚¹ï¼‰ï¼Œé€‚åˆè®¡ç®—ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„å·®å¼‚ã€‚
* ç²¾åº¦é«˜è¾¾ **çº³ç§’ï¼ˆnsï¼‰çº§åˆ«**ã€‚
* **ä¸å—ç³»ç»Ÿæ—¶é—´æ›´æ”¹çš„å½±å“**ï¼ˆä¾‹å¦‚ç”¨æˆ·ä¿®æ”¹ç³»ç»Ÿæ—¶é’Ÿï¼‰ã€‚

### ğŸ§ª ä½¿ç”¨æ–¹å¼

```js
const start = process.hrtime();

// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
for (let i = 0; i < 1e6; i++) {}

const diff = process.hrtime(start); // è¿”å› [seconds, nanoseconds]
console.log(`è€—æ—¶: ${diff[0]} ç§’ ${diff[1]} çº³ç§’`);

// å¯ä»¥è½¬ä¸ºæ¯«ç§’
const durationInMs = diff[0] * 1000 + diff[1] / 1e6;
console.log(`è€—æ—¶: ${durationInMs.toFixed(3)} æ¯«ç§’`);
```

### ğŸ§  æ³¨æ„äº‹é¡¹

* ç»“æœæ€»æ˜¯è¿”å›ä¸€ä¸ªæ•°ç»„ `[seconds, nanoseconds]`ã€‚
* å› ä¸ºæ˜¯ç›¸å¯¹æ—¶é—´ï¼Œé€‚åˆè®¡ç®—ã€Œæ—¶é—´å·®ã€ï¼Œ**ä¸é€‚åˆè·å–å½“å‰æ—¶é—´æˆ³**ã€‚

---

## äºŒã€`perf_hooks.performance.now()`ï¼šé«˜åˆ†è¾¨ç‡ç»å¯¹æ—¶é—´æˆ³

### âœ… ç‰¹ç‚¹

* æ¥è‡ªæ ‡å‡†æ¨¡å— `perf_hooks`ã€‚
* è¿”å›è‡ªç¨‹åºå¯åŠ¨ä»¥æ¥çš„ **æ¯«ç§’æ•°**ï¼ˆå¸¦å°æ•°ç‚¹ï¼Œç²¾åº¦å¯è¾¾å¾®ç§’ç”šè‡³çº³ç§’ï¼‰ã€‚
* æ›´åƒæµè§ˆå™¨ä¸­çš„ `performance.now()`ã€‚
* ç²¾åº¦æ¯” `Date.now()` é«˜å¾—å¤šã€‚

### ğŸ§ª ä½¿ç”¨æ–¹å¼

```js
const { performance } = require('perf_hooks');

const start = performance.now();

for (let i = 0; i < 1e6; i++) {}

const end = performance.now();
console.log(`è€—æ—¶: ${(end - start).toFixed(3)} æ¯«ç§’`);
```

### ğŸ§  æ³¨æ„äº‹é¡¹

* è¿”å›çš„æ˜¯ä»¥ **æ¯«ç§’ä¸ºå•ä½çš„æµ®ç‚¹æ•°**ï¼ˆå¯ä»¥ç²¾ç¡®åˆ°å¾®ç§’çº§ï¼‰ã€‚
* æ›´é€‚åˆç”¨æ¥è·å–é«˜ç²¾åº¦æ—¶é—´æˆ³ã€‚

---

## ä¸‰ã€å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§        | `process.hrtime()` | `performance.now()` |
| --------- | ------------------ | ------------------- |
| ç²¾åº¦        | çº³ç§’ï¼ˆnsï¼‰             | å¾®ç§’\~çº³ç§’ï¼ˆmsï¼Œå°æ•°ï¼‰       |
| è¿”å›å€¼       | `[ç§’, çº³ç§’]`æ•°ç»„        | æ¯«ç§’ï¼ˆæµ®ç‚¹æ•°ï¼‰             |
| èµ·å§‹ç‚¹       | ä»»æ„å‚è€ƒç‚¹ï¼ˆä¸å¯çŸ¥ï¼‰         | ç¨‹åºå¯åŠ¨æ—¶               |
| é€‚åˆç”¨é€”      | ä¸¤ä¸ªæ—¶é—´ç‚¹é—´çš„å·®å€¼          | å½“å‰æ—¶é—´æˆ³ã€é«˜ç²¾åº¦å®šæ—¶         |
| æ˜¯å¦å—ç³»ç»Ÿæ—¶é—´å½±å“ | å¦                  | å¦                   |

---

## å››ã€å°è£…ä¸€ä¸ªçº³ç§’è®¡æ—¶å‡½æ•°ï¼ˆæ¨èæ–¹å¼ï¼‰

ä½ å¯ä»¥å°è£…ä¸€ä¸ªç»Ÿä¸€çš„é«˜ç²¾åº¦è®¡æ—¶å·¥å…·ï¼š

```js
function nsTimer() {
  const start = process.hrtime.bigint(); // Node 10+ æ”¯æŒ BigInt
  return () => {
    const end = process.hrtime.bigint();
    const durationNs = end - start;
    return {
      ns: durationNs,
      ms: Number(durationNs) / 1e6,
    };
  };
}

// ä½¿ç”¨
const stop = nsTimer();

for (let i = 0; i < 1e6; i++) {}

const { ns, ms } = stop();
console.log(`è€—æ—¶: ${ns} çº³ç§’ (${ms.toFixed(3)} æ¯«ç§’)`);
```

---

## äº”ã€è¡¥å……ï¼šä¸ºä»€ä¹ˆä¸ç”¨ `Date.now()`ï¼Ÿ

* `Date.now()` ç²¾åº¦åªåˆ° **æ¯«ç§’ï¼ˆmsï¼‰çº§åˆ«**ã€‚
* å®¹æ˜“å—åˆ°ç³»ç»Ÿæ—¶é—´å˜æ›´å½±å“ã€‚
* **ä¸é€‚åˆé«˜ç²¾åº¦æ€§èƒ½æµ‹è¯•æˆ–è®¡æ—¶ä»»åŠ¡**ã€‚

---

## âœ… æ€»ç»“

å¦‚æœä½ éœ€è¦åœ¨ Node.js ä¸­å®ç°çº³ç§’çº§åˆ«çš„é«˜ç²¾åº¦è®¡æ—¶ï¼š

* âœ… æ¨èä½¿ç”¨ `process.hrtime.bigint()` è·å–çœŸå®çº³ç§’å·®å€¼ï¼›
* âœ… æˆ–ä½¿ç”¨ `perf_hooks.performance.now()` è·å–é«˜ç²¾åº¦çš„æ—¶é—´æˆ³ï¼›
* âŒ é¿å…ä½¿ç”¨ `Date.now()` è¿›è¡Œå¾®å°æ—¶é—´å·®çš„æµ‹é‡ã€‚

å¦‚æœä½ å‘Šè¯‰æˆ‘å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼ˆæ¯”å¦‚æ€§èƒ½æµ‹è¯•ã€æ‰“ç‚¹æ—¥å¿—ã€é™é€Ÿå™¨ã€å¾®ç§’è°ƒåº¦ï¼‰ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥ç»™ä½ æ›´åˆé€‚çš„å»ºè®®ã€‚
