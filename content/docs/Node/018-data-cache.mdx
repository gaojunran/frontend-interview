---
title: å¦‚ä½•åœ¨ Node.js ä¸­å®ç°æ•°æ®çš„ç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ï¼Ÿ
---

åœ¨ Node.js ä¸­ï¼Œå®ç°**æ•°æ®ç¼“å­˜**æ˜¯ä¸€ç§å¸¸è§çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚ç¼“å­˜å¯ä»¥å‡å°‘æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿæˆ–å¤–éƒ¨ API çš„é‡å¤è¯·æ±‚ï¼Œä»è€Œæé«˜å“åº”é€Ÿåº¦å’Œç³»ç»Ÿååé‡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è®²è§£ï¼ŒåŒ…æ‹¬åŸç†ã€åœºæ™¯ã€ç¼“å­˜å±‚çº§ã€å¸¸ç”¨æŠ€æœ¯åŠä»£ç ç¤ºä¾‹ã€‚

---

## ğŸ§  ä¸€ã€ä¸ºä»€ä¹ˆè¦ç¼“å­˜ï¼Ÿ

* é™ä½ I/O æˆæœ¬ï¼šé¿å…é¢‘ç¹è®¿é—®æ•°æ®åº“ã€ç£ç›˜æˆ–è¿œç¨‹æœåŠ¡ã€‚
* æå‡æ€§èƒ½ï¼šå‡å°‘å»¶è¿Ÿï¼Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚
* å‡å°‘èµ„æºæ¶ˆè€—ï¼šç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œé™ä½ç³»ç»Ÿå‹åŠ›ã€‚

---

## ğŸ“š äºŒã€å¸¸è§çš„ç¼“å­˜åœºæ™¯

| åœºæ™¯     | ç¤ºä¾‹                        |
| ------ | ------------------------- |
| å†…å­˜ç¼“å­˜   | ç¼“å­˜æ•°æ®åº“æŸ¥è¯¢ç»“æœã€é…ç½®æ–‡ä»¶å†…å®¹ç­‰         |
| åˆ†å¸ƒå¼ç¼“å­˜  | ä½¿ç”¨ Redis ç¼“å­˜ç™»å½•çŠ¶æ€ã€éªŒè¯ç ã€é¡µé¢æ•°æ®ç­‰ |
| é¡µé¢ç¼“å­˜   | å°†æ•´ä¸ª HTML é¡µé¢ç¼“å­˜             |
| é™æ€èµ„æºç¼“å­˜ | ç¼“å­˜å›¾ç‰‡ã€JSã€CSS ç­‰èµ„æº           |
| CDN ç¼“å­˜ | ä½¿ç”¨ CDN ç¼“å­˜å†…å®¹åœ¨è¾¹ç¼˜èŠ‚ç‚¹          |

---

## ğŸ§± ä¸‰ã€ç¼“å­˜çš„å±‚çº§

1. **æœ¬åœ°å†…å­˜ç¼“å­˜ï¼ˆè¿›ç¨‹å†…ï¼‰**

   * ä½¿ç”¨å¦‚ `Map` æˆ– `lru-cache`ã€‚
   * ä¼˜ç‚¹ï¼šæœ€å¿«é€Ÿã€é›¶å»¶è¿Ÿã€‚
   * ç¼ºç‚¹ï¼šé‡å¯å¤±æ•ˆã€é›†ç¾¤ä¸å¯å…±äº«ã€‚

2. **åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆè¿›ç¨‹å¤–ï¼‰**

   * ä½¿ç”¨ Redisã€Memcachedã€‚
   * ä¼˜ç‚¹ï¼šå¯æŒä¹…ã€å¤šè¿›ç¨‹å…±äº«ã€‚
   * ç¼ºç‚¹ï¼šè®¿é—®æœ‰ç½‘ç»œå¼€é”€ã€‚

3. **æµè§ˆå™¨ç¼“å­˜**

   * è®¾ç½® HTTP Cache-Controlã€ETagã€‚
   * ç”¨äºå‰ç«¯ä¼˜åŒ–ã€‚

---

## ğŸ’¡ å››ã€Node.js ä¸­ç¼“å­˜çš„å®ç°æ–¹å¼

### âœ… æ–¹æ³• 1ï¼šä½¿ç”¨å†…å­˜ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰

```js
// ç®€å• Map ä½œä¸ºç¼“å­˜
const cache = new Map();

function getData(key) {
  if (cache.has(key)) {
    return Promise.resolve(cache.get(key));
  }

  // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®æºï¼ˆå¦‚æ•°æ®åº“ï¼‰
  return fetchDataFromDB(key).then(data => {
    cache.set(key, data);
    return data;
  });
}
```

### âœ… æ–¹æ³• 2ï¼šä½¿ç”¨ `lru-cache`ï¼ˆå¸¦è‡ªåŠ¨è¿‡æœŸï¼‰

```bash
npm install lru-cache
```

```js
const LRU = require('lru-cache');

const options = {
  max: 100,             // æœ€å¤§ç¼“å­˜é¡¹æ•°
  ttl: 1000 * 60 * 5    // æ¯é¡¹ç¼“å­˜æœ‰æ•ˆæœŸï¼š5 åˆ†é’Ÿ
};
const cache = new LRU(options);

function getData(key) {
  const cached = cache.get(key);
  if (cached) return Promise.resolve(cached);

  return fetchDataFromDB(key).then(data => {
    cache.set(key, data);
    return data;
  });
}
```

### âœ… æ–¹æ³• 3ï¼šä½¿ç”¨ Redisï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰

```bash
npm install redis
```

```js
const redis = require('redis');
const client = redis.createClient();

client.connect();

async function getData(key) {
  const cached = await client.get(key);
  if (cached) {
    return JSON.parse(cached);
  }

  const data = await fetchDataFromDB(key);
  await client.set(key, JSON.stringify(data), { EX: 300 }); // è¿‡æœŸæ—¶é—´ 5 åˆ†é’Ÿ
  return data;
}
```

---

## ğŸ“ˆ äº”ã€ç¼“å­˜å¤±æ•ˆç­–ç•¥

| ç­–ç•¥                         | è¯´æ˜          |
| -------------------------- | ----------- |
| TTLï¼ˆTime To Liveï¼‰          | è®¾ç½®æœ‰æ•ˆæ—¶é—´ï¼Œè‡ªåŠ¨è¿‡æœŸ |
| LRUï¼ˆLeast Recently Usedï¼‰   | ç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ® |
| LFUï¼ˆLeast Frequently Usedï¼‰ | ç§»é™¤è®¿é—®é¢‘ç‡æœ€ä½çš„æ•°æ® |
| æ‰‹åŠ¨å¤±æ•ˆ                       | æ›´æ–°æ—¶ä¸»åŠ¨æ¸…ç†ç¼“å­˜   |

---

## ğŸ”’ å…­ã€ç¼“å­˜ä¸€è‡´æ€§ç­–ç•¥

* **è¯»å†™ç©¿é€**ï¼šç¼“å­˜æ²¡æœ‰æ•°æ®æ—¶ä»æ•°æ®åº“æŸ¥ï¼Œå†å†™å…¥ç¼“å­˜ã€‚
* **ç¼“å­˜é›ªå´©**ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´ç³»ç»Ÿè¢«å‡»ç©¿ã€‚è§£å†³ï¼šè®¾ç½®éšæœº TTLã€‚
* **ç¼“å­˜å‡»ç©¿**ï¼šæŸä¸€çƒ­ç‚¹ç¼“å­˜çªç„¶å¤±æ•ˆï¼Œå¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ã€‚è§£å†³ï¼šåŠ é” / åŒç¼“å­˜ã€‚
* **æ›´æ–°ç­–ç•¥**ï¼š

  * å†™æ—¶æ›´æ–°ï¼ˆwrite-throughï¼‰
  * åˆ é™¤ç¼“å­˜ï¼ˆcache invalidationï¼‰
  * å¼‚æ­¥æ›´æ–°ï¼ˆbackground refreshï¼‰

---

## ğŸ› ï¸ ä¸ƒã€è¿›é˜¶æ–¹æ¡ˆ

* ä½¿ç”¨ `node-cache-manager` å®ç°å¤šç§ç¼“å­˜ç­–ç•¥ï¼ˆå†…å­˜ + Redis ç­‰ï¼‰
* ä½¿ç”¨ `axios-cache-adapter` ä¸º HTTP è¯·æ±‚åŠ ç¼“å­˜
* é’ˆå¯¹ GraphQL å¯ç”¨ `apollo-server` çš„ cache åŠŸèƒ½

---

## âœ… æ€»ç»“

| æŠ€æœ¯          | ä¼˜ç‚¹        | ç¼ºç‚¹      | é€‚ç”¨åœºæ™¯    |
| ----------- | --------- | ------- | ------- |
| Map / LRU   | å¿«é€Ÿã€æœ¬åœ°     | ä¸å¯å…±äº«    | å•è¿›ç¨‹ç¼“å­˜   |
| Redis       | è·¨è¿›ç¨‹å…±äº«ã€æŒä¹…åŒ– | ç½‘ç»œå»¶è¿Ÿ    | å¤šå®ä¾‹ã€åˆ†å¸ƒå¼ |
| CDN / æµè§ˆå™¨ç¼“å­˜ | é›¶æœåŠ¡å™¨è´Ÿè½½    | ä¸é€‚åˆåŠ¨æ€æ•°æ® | é™æ€èµ„æº    |

---

å¦‚æœä½ æœ‰å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚â€œç¼“å­˜ API è¿”å›â€æˆ–â€œç¼“å­˜æ•°æ®åº“æŸ¥è¯¢â€ï¼Œæˆ‘å¯ä»¥å†ç»™å‡ºé’ˆå¯¹æ€§çš„ä»£ç ç¤ºä¾‹å’Œå»ºè®®ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
