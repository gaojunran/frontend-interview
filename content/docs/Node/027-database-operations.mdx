---
title: åœ¨ Node.js ä¸­å¦‚ä½•è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚ä½¿ç”¨ä»€ä¹ˆ DB å’Œ ORMï¼Ÿ
---

åœ¨ Node.js ä¸­è¿›è¡Œæ•°æ®åº“æ“ä½œæ˜¯åç«¯å¼€å‘çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ã€‚ä½ å¯ä»¥è¿æ¥å„ç§ç±»å‹çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬ **å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰** å’Œ **éå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MongoDBã€Redisï¼‰**ã€‚

---

## ğŸ§± å¸¸ç”¨æ•°æ®åº“ç±»å‹

| ç±»å‹      | å¸¸è§æ•°æ®åº“                            | è¯´æ˜                                         |
| ------- | -------------------------------- | ------------------------------------------ |
| å…³ç³»å‹æ•°æ®åº“  | MySQL, PostgreSQL, SQLite, MSSQL | ä½¿ç”¨ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ˆSQLï¼‰æ“ä½œï¼Œæœ‰è¡¨ç»“æ„å’Œçº¦æŸã€‚é€‚åˆå¼ºä¸€è‡´æ€§åœºæ™¯ã€‚         |
| éå…³ç³»å‹æ•°æ®åº“ | MongoDB, Redis, Cassandra        | ä½¿ç”¨ JSON/BSON æˆ–é”®å€¼å¯¹ï¼Œçµæ´»ã€æ‰©å±•æ€§å¼ºï¼Œé€‚åˆå¤§æ•°æ®ã€é«˜å¹¶å‘ã€ç¼“å­˜ç­‰åœºæ™¯ã€‚ |

---

## ğŸ”§ Node.js å¸¸ç”¨æ•°æ®åº“é©±åŠ¨å’Œ ORM/ODM

### 1. **MongoDB + Mongooseï¼ˆODMï¼‰**

* **MongoDB** æ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼Œé€‚åˆ JSON æ–‡æ¡£ç»“æ„ã€‚
* **Mongoose** æ˜¯ MongoDB çš„ ORMï¼ˆå‡†ç¡®è¯´æ˜¯ ODMï¼ŒObject Data Modelingï¼‰ã€‚

#### å®‰è£…ï¼š

```bash
npm install mongoose
```

#### ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
const mongoose = require('mongoose');

mongoose.connect('mongodb://localhost:27017/mydb');

const userSchema = new mongoose.Schema({
  name: String,
  age: Number,
});

const User = mongoose.model('User', userSchema);

async function main() {
  const user = new User({ name: 'Alice', age: 25 });
  await user.save();

  const users = await User.find();
  console.log(users);
}

main();
```

---

### 2. **MySQL / PostgreSQL + Sequelizeï¼ˆORMï¼‰**

* Sequelize æ˜¯æ”¯æŒå¤šç§ SQL æ•°æ®åº“çš„ ORM æ¡†æ¶ã€‚

#### å®‰è£…ï¼š

```bash
npm install sequelize mysql2   # MySQL
# or
npm install sequelize pg pg-hstore   # PostgreSQL
```

#### ä½¿ç”¨ç¤ºä¾‹ï¼ˆMySQLï¼‰ï¼š

```js
const { Sequelize, DataTypes } = require('sequelize');
const sequelize = new Sequelize('testdb', 'root', 'password', {
  host: 'localhost',
  dialect: 'mysql'
});

const User = sequelize.define('User', {
  name: DataTypes.STRING,
  age: DataTypes.INTEGER
});

async function main() {
  await sequelize.sync();

  await User.create({ name: 'Bob', age: 30 });

  const users = await User.findAll();
  console.log(users.map(u => u.toJSON()));
}

main();
```

---

### 3. **Prismaï¼ˆç°ä»£åŒ– ORMï¼‰**

Prisma æ˜¯è¿‘å¹´æ¥éå¸¸æµè¡Œçš„ç±»å‹å®‰å…¨ ORMï¼Œé€‚ç”¨äº PostgreSQLã€MySQLã€SQLite ç­‰ã€‚

#### å®‰è£…å¹¶åˆå§‹åŒ–ï¼š

```bash
npm install prisma --save-dev
npx prisma init
```

ç¼–è¾‘ `prisma/schema.prisma`ï¼š

```prisma
model User {
  id    Int     @id @default(autoincrement())
  name  String
  email String  @unique
}
```

ç„¶åç”Ÿæˆå®¢æˆ·ç«¯å¹¶æ‰§è¡Œè¿ç§»ï¼š

```bash
npx prisma migrate dev --name init
npx prisma generate
```

#### ä½¿ç”¨ï¼š

```js
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

async function main() {
  await prisma.user.create({
    data: {
      name: 'Charlie',
      email: 'charlie@example.com',
    },
  });

  const users = await prisma.user.findMany();
  console.log(users);
}

main();
```

---

## ğŸ“¦ ORM ä¸åŸç”Ÿé©±åŠ¨å¯¹æ¯”

| ç‰¹æ€§   | ORMï¼ˆå¦‚ Sequelize, Prismaï¼‰ | åŸç”Ÿé©±åŠ¨ï¼ˆå¦‚ mysql2, pgï¼‰ |
| ---- | ------------------------ | ------------------ |
| å¼€å‘æ•ˆç‡ | âœ… é«˜                      | âŒ ä½                |
| ç±»å‹å®‰å…¨ | âœ… Prisma éå¸¸å¥½             | âŒ æ‰‹åŠ¨å¤„ç†             |
| å¯ç§»æ¤æ€§ | âœ… å¤šæ•°æ®åº“æ”¯æŒ                 | âŒ é™å®šæŸä¸ªæ•°æ®åº“          |
| æ€§èƒ½æ§åˆ¶ | âŒ è¢«æŠ½è±¡å±‚åŒ…è£¹                 | âœ… ç²¾ç»†æ§åˆ¶æŸ¥è¯¢           |
| å­¦ä¹ æ›²çº¿ | ä¸­ç­‰                       | ç®€å•ä½†å®¹æ˜“å‡ºé”™            |

---

## ğŸ›  æ•°æ®åº“æ“ä½œå»ºè®®

1. **å¼€å‘æœŸ**ï¼šæ¨èä½¿ç”¨ ORM å¿«é€Ÿå»ºæ¨¡ï¼ˆPrisma / Sequelize / Mongooseï¼‰ã€‚
2. **ç”Ÿäº§æœŸ**ï¼š

   * ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ã€‚
   * å¯¹å¤§æŸ¥è¯¢ä½¿ç”¨åŸç”Ÿ SQLï¼ˆå¦‚é€šè¿‡ Prisma çš„ `queryRaw`ï¼‰ã€‚
   * é¿å… N+1 æŸ¥è¯¢ï¼Œä½¿ç”¨å…³è”é¢„åŠ è½½ï¼ˆinclude / populateï¼‰ã€‚
3. **å®‰å…¨æ€§**ï¼š

   * é˜² SQL æ³¨å…¥ï¼ˆORM é»˜è®¤ä¼šå¤„ç†ï¼‰ã€‚
   * æ ¡éªŒç”¨æˆ·è¾“å…¥ï¼ˆæ¨èä½¿ç”¨ `Joi`, `zod` ç­‰åº“ï¼‰ã€‚
4. **æ€§èƒ½è°ƒä¼˜**ï¼š

   * æ·»åŠ ç´¢å¼•ã€‚
   * ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ã€‚
   * åˆ†é¡µã€æ‰¹é‡æ’å…¥ã€äº‹åŠ¡æ§åˆ¶ç­‰ã€‚

---

## âœ… æ€»ç»“

| åœºæ™¯          | æ¨èæŠ€æœ¯æ ˆ                       |
| ----------- | --------------------------- |
| æ–‡æ¡£å‹å­˜å‚¨       | MongoDB + Mongoose          |
| ç»“æ„åŒ–å…³ç³»å‹æ•°æ®    | PostgreSQL / MySQL + Prisma |
| å¿«é€Ÿå¼€å‘ + ç±»å‹å®‰å…¨ | Prisma                      |
| ä½å±‚æ§åˆ¶        | åŸç”Ÿé©±åŠ¨ï¼ˆå¦‚ `pg`, `mysql2`ï¼‰      |

å¦‚ä½ æœ‰ç‰¹å®šçš„æ•°æ®åº“åœºæ™¯ï¼ˆæ¯”å¦‚ Redis ç¼“å­˜ã€SQL æŸ¥è¯¢ä¼˜åŒ–ã€å¤šç§Ÿæˆ·æ¶æ„ç­‰ï¼‰ï¼Œæˆ‘å¯ä»¥ç»§ç»­æ·±å…¥è®²ã€‚æ˜¯å¦æœ‰å…·ä½“éœ€æ±‚ï¼Ÿ
