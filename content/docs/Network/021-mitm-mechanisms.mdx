---
title: 中间人攻击 (MITM) 是怎么实现的？
---

你问到的点非常关键，这就是 **MITM 能“解密”HTTPS 的核心机制**。
我详细拆开一步步讲，你就能理解为什么中间人能看到明文。

---

## 🔑 HTTPS 正常流程回顾

先回顾一下正常的 HTTPS 握手（简化版）：

1. **客户端 → 服务器**：
   发送 `ClientHello`，包括支持的加密算法、随机数等
2. **服务器 → 客户端**：
   发送 `ServerHello` 和服务器证书
3. **客户端验证证书**：
   确认服务器的证书由受信任的 CA 签发
4. **密钥协商**：
   双方用非对称算法协商出对称密钥
5. **后续通信用对称密钥加密**

关键点：
握手完成后，只有客户端和服务器知道这个对称密钥，所以只有他们能解密后续数据。

---

## 🕵️ 中间人攻击的“解密”原理

中间人要能解密，就必须让自己也参与握手，自己也拿到一个对称密钥。它是这样做的：

### 1️⃣ 劫持流量

先让客户端的流量经过自己（ARP 欺骗、DNS 劫持、网关控制等），这样它能拦截握手。

### 2️⃣ 欺骗客户端

* 客户端发 `ClientHello`
* **中间人伪装成服务器**，返回一个伪造的证书（实际上是中间人的证书）
* 如果客户端信任这个证书，就继续握手

### 3️⃣ 建立两条独立的加密通道

* **客户端 ↔ 中间人**
  握手协商出一个密钥 `K1`
  客户端用 `K1` 加密请求发给中间人
* **中间人 ↔ 真服务器**
  中间人自己和服务器再来一遍 TLS 握手，协商出另一个密钥 `K2`
  中间人用 `K2` 加密把客户端请求转发给服务器

### 4️⃣ 中间人可见明文

中间人收到客户端用 `K1` 加密的流量，因为它自己参与了握手，知道 `K1`，就能解密拿到明文，再用 `K2` 加密转发给服务器。

整个过程如下图：

```
Client         MITM         Server
  | --- ClientHello ------>  |
  |                         |
  | <--- FakeCert + Hello --|  (MITM用自己的证书)
  |                         |
  | ----(K1握手)----------> |
  |                         |
  |    [明文可见]           |
  |                         | --- ServerHello + Cert ---->
  |                         | <--- (K2握手) -------------
  |                         |
  | <===> 加密通道K1 <===>  | <===> 加密通道K2 <===> |
```

---

## ⚠️ 关键条件：客户端必须信任中间人的证书

如果客户端不信任，浏览器会直接报红：

> “证书不受信任，连接不安全”

所以：

* 抓包工具（Charles、Fiddler、Burp Suite）会让你**手动安装它们的根证书**
* 企业网关代理会把企业 CA 根证书推到你的设备里
* 一旦客户端信任这个 CA，MITM 就能签发任意域名的证书而不报警

---

## 🎯 总结

中间人能“解密”HTTPS，是因为它：

1. 伪造证书骗过客户端
2. 和客户端、服务器各自建立独立的 TLS 会话
3. 拿到客户端发送的密文后，用自己参与握手得到的密钥解密
4. 重新加密后转发给服务器

它**不是破解 TLS**，而是通过“假装自己是服务器”插在中间。

---

要不要我帮你画一张更直观的示意图（握手和解密流程，显示两条加密隧道）？你看一眼就能理解为什么中间人能看到明文。

