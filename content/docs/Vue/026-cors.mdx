---
title: Vueé¡¹ç›®ä¸­ä½ æ˜¯å¦‚ä½•è§£å†³è·¨åŸŸçš„å‘¢ï¼Ÿ
---

å½“é¢è¯•å®˜é—®åˆ°â€œ**Vue/Vite é¡¹ç›®ä¸­ä½ æ˜¯å¦‚ä½•è§£å†³è·¨åŸŸçš„**â€ï¼Œæˆ‘ä¼šè¿™æ ·å›ç­”ï¼š

---

åœ¨ Vue æˆ– Vite é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ¬åœ°ç¯å¢ƒç»å¸¸ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯æµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é€šå¸¸é‡‡ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼è§£å†³è·¨åŸŸï¼š

### âœ… **å¼€å‘ç¯å¢ƒä¸‹ï¼šä½¿ç”¨ Vite çš„ä»£ç†åŠŸèƒ½**

Vite æä¾›äº†å†…å»ºçš„ä»£ç†é…ç½®ï¼Œå¯ä»¥æŠŠå‰ç«¯è¯·æ±‚ä»£ç†è½¬å‘åˆ°åç«¯ï¼Œä»è€Œç»•è¿‡æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚

æˆ‘ä¼šåœ¨ `vite.config.ts` ä¸­é…ç½® `server.proxy`ï¼Œä¾‹å¦‚ï¼š

```ts
// vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080', // åç«¯æ¥å£åœ°å€
        changeOrigin: true,              // æ˜¯å¦ä¿®æ”¹è¯·æ±‚æº
        rewrite: (path) => path.replace(/^\/api/, ''), // é‡å†™è·¯å¾„
      },
    },
  },
});
```

è¿™æ ·ï¼Œå¼€å‘æ—¶è¯·æ±‚ `/api/user` å®é™…ä¼šè¢«ä»£ç†ä¸º `http://localhost:8080/user`ã€‚

---

### âœ… **ç”Ÿäº§ç¯å¢ƒï¼šåç«¯é…ç½®è·¨åŸŸ**

ä¸Šçº¿åä¸èƒ½ä½¿ç”¨ Vite ä»£ç†ï¼Œæ­¤æ—¶éœ€è¦ç”±åç«¯è®¾ç½® CORS å¤´æ¥æ”¯æŒè·¨åŸŸè¯·æ±‚ã€‚

ä¾‹å¦‚åœ¨ Node.js ä¸­ä½¿ç”¨ï¼š

```js
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE');
```

æˆ–è€…ä½¿ç”¨æ¡†æ¶è‡ªå¸¦ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ Express ä¸­çš„ `cors`ï¼š

```js
const cors = require('cors');
app.use(cors());
```

å¦‚æœåç«¯é™åˆ¶æ¥æºï¼Œå¯ä»¥è®¾ç½®ä¸ºï¼š

```js
res.setHeader('Access-Control-Allow-Origin', 'https://your-domain.com');
```

---

### ğŸ”„ **å¦‚æœæ˜¯éåŒæº iframeã€cookie åœºæ™¯ï¼š**

* ä¸»ç³»ç»Ÿï¼ˆå‰ç«¯é¡µé¢ï¼‰ï¼š`https://main.example.com`
* å­ç³»ç»Ÿï¼ˆåµŒå…¥ iframe çš„ç³»ç»Ÿï¼‰ï¼š`https://sub.example.com`

æˆ‘ä»¬åœ¨ä¸»ç³»ç»Ÿä¸­é€šè¿‡ `<iframe src="https://sub.example.com/login">` æ–¹å¼åµŒå…¥å¦ä¸€ä¸ªç«™ç‚¹çš„é¡µé¢ã€‚è¿™æ—¶å°±å±äº**è·¨åŸŸ iframe**ã€‚

---

#### âœ… é—®é¢˜ 1ï¼š**JavaScript æ— æ³•è®¿é—® iframe å†…å®¹**

> ç”±äºåŒæºç­–ç•¥ï¼Œä¸»é¡µé¢ JS æ— æ³•è®¿é—® iframe ä¸­çš„ DOMã€window ç­‰å†…å®¹ï¼Œåä¹‹äº¦ç„¶ã€‚

```js
const iframe = document.querySelector('iframe');
console.log(iframe.contentWindow.document); // âŒ æŠ¥é”™ï¼šBlocked a frame with origin
```

ğŸ‘‰ **è§£å†³æ–¹å¼ï¼šåªèƒ½é€šè¿‡ `postMessage` é€šä¿¡æœºåˆ¶å®ç°æ•°æ®äº¤æ¢ã€‚**

---

#### âœ… é—®é¢˜ 2ï¼š**æ¥å£æ— æ³•æºå¸¦ cookieï¼ˆèº«ä»½éªŒè¯å¤±æ•ˆï¼‰**


è¿™æ˜¯å› ä¸ºæµè§ˆå™¨é»˜è®¤åœ¨**è·¨åŸŸè¯·æ±‚ä¸­ç¦ç”¨ç¬¬ä¸‰æ–¹ Cookie**ï¼ˆå°¤å…¶åœ¨ Safariã€Chrome çš„éšç§å¢å¼ºè®¾ç½®ä¸­ï¼‰ã€‚

---

#### âœ… 3. å¦‚ä½•å¤„ç† cookie é—®é¢˜ï¼ˆå…³é”®ï¼‰

è¦è®©è¯·æ±‚å¯ä»¥æºå¸¦ cookieï¼Œå‰ç«¯å’Œåç«¯éƒ½éœ€è¦åšæ­£ç¡®é…ç½®ã€‚

##### ğŸ§© å‰ç«¯è®¾ç½®ï¼š`credentials: 'include'`

```ts
fetch('https://sub.example.com/api/user', {
  method: 'GET',
  credentials: 'include', // æ˜¾å¼å‘Šè¯‰æµè§ˆå™¨å¸¦ä¸Š cookie
});
```

##### ğŸ§© åç«¯è®¾ç½®ï¼š

```http
Access-Control-Allow-Origin: https://main.example.com
Access-Control-Allow-Credentials: true
```

> âš ï¸ æ³¨æ„ï¼š**æ­¤æ—¶ä¸èƒ½ä½¿ç”¨ `Access-Control-Allow-Origin: *`ï¼Œå¿…é¡»æŒ‡å®šå…·ä½“æ¥æºã€‚**

---

#### ğŸ›¡ï¸ 4. æµè§ˆå™¨é™åˆ¶ï¼ˆå°¤å…¶æ˜¯ Safariï¼‰

å³ä½¿é…ç½®æ­£ç¡®ï¼Œä¸€äº›æµè§ˆå™¨ï¼ˆå¦‚ Safariï¼‰ä»å¯èƒ½æ‹¦æˆªç¬¬ä¸‰æ–¹ Cookieï¼š

* é»˜è®¤é˜»æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼ˆITP æœºåˆ¶ï¼‰
* è§£å†³æ–¹æ¡ˆæœ‰é™ï¼Œå¯èƒ½éœ€è¦ç”¨ **åŒæºéƒ¨ç½²**ï¼ˆè®©ä¸»åŸŸå’Œ iframe ä½¿ç”¨ç›¸åŒçš„ä¸»åŸŸåï¼Œä¾‹å¦‚å­åŸŸåï¼‰æˆ–é‡‡ç”¨ Token æœºåˆ¶æ›¿ä»£ Cookieã€‚

---

#### âœ… 5. å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

1. **æŠŠå­ç³»ç»Ÿéƒ¨ç½²ä¸ºä¸»åŸŸçš„å­åŸŸ**ï¼ˆå¦‚ `sub.main.com`ï¼‰ï¼›
2. æœåŠ¡ç«¯è®¾ç½® `Set-Cookie` æ—¶ï¼Œé…ç½®ï¼š

   ```http
   Set-Cookie: sessionId=abc123; Domain=.main.com; Path=/; SameSite=None; Secure
   ```
3. è®¾ç½® `SameSite=None` + `Secure` æ˜¯ä¸ºäº†å…è®¸è·¨åŸŸä½¿ç”¨ç¬¬ä¸‰æ–¹ Cookieï¼ˆå¿…é¡»æ˜¯ HTTPSï¼‰ï¼›
4. å‰ç«¯è¯·æ±‚åŠ ä¸Š `credentials: 'include'`ï¼›
5. åç«¯ `Access-Control-Allow-Origin` è®¾ç½®ä¸ºæŒ‡å®šä¸»åŸŸï¼Œå¹¶å…è®¸ `credentials: true`ã€‚

---

### âœ… **æ€»ç»“ï¼š**

* **å¼€å‘ç¯å¢ƒç”¨ä»£ç†ï¼ˆVite Proxyï¼‰**ï¼Œæ–¹ä¾¿å¿«æ·ã€‚
* **ç”Ÿäº§ç¯å¢ƒç”±åç«¯è®¾ç½® CORS**ï¼Œç¡®ä¿å®‰å…¨æ€§å’Œå…¼å®¹æ€§ã€‚
* é‡åˆ°æ›´å¤æ‚åœºæ™¯ï¼ˆå¦‚ cookieã€iframeï¼‰ï¼Œè¦é…åˆè®¾ç½® `credentials` å’Œç²¾å‡†çš„ `origin`ã€‚



