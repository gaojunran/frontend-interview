---
title: ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨è®¡æ—¶å™¨åš JS åŠ¨ç”»ï¼Ÿ
---

è¿™æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„é—®é¢˜ ðŸ‘ã€‚è¡¨é¢ä¸Šçœ‹ï¼Œç”¨ `setInterval` / `setTimeout` å®šæ—¶æ›´æ–°å…ƒç´ æ ·å¼å°±èƒ½åšåŠ¨ç”»ï¼Œä½†å®žé™…ä¸Š **è®¡æ—¶å™¨é©±åŠ¨çš„åŠ¨ç”»å­˜åœ¨å¾ˆå¤šå±€é™**ï¼Œæ‰€ä»¥çŽ°ä»£ Web åŠ¨ç”»æ›´æŽ¨èç”¨ `requestAnimationFrame` (rAF) æˆ– CSS åŠ¨ç”»ã€‚ä¸‹é¢æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆ **è®¡æ—¶å™¨ä¸é€‚åˆåš JS åŠ¨ç”»**ï¼š

---

## 1. è®¡æ—¶å™¨å¹¶ä¸ç²¾ç¡®

* `setTimeout(fn, 16)` ä½ å¯èƒ½ä»¥ä¸ºå°±æ˜¯ **æ¯ 16ms è°ƒç”¨ä¸€æ¬¡**ï¼Œçº¦ç­‰äºŽ 60fpsã€‚
* ä½†æµè§ˆå™¨çš„ **äº‹ä»¶å¾ªçŽ¯ (event loop)** ä¼šå¯¼è‡´å›žè°ƒå¹¶ä¸å‡†æ—¶æ‰§è¡Œï¼š

  * å¦‚æžœä¸»çº¿ç¨‹å¾ˆå¿™ï¼ˆæ¸²æŸ“ã€å¸ƒå±€ã€JS è¿ç®—ï¼‰ï¼Œå›žè°ƒå°±ä¼šè¢«æŽ¨è¿Ÿã€‚
  * ä¸åŒæµè§ˆå™¨ã€ä¸åŒç¡¬ä»¶ã€åŽå° tabã€CPU é™é¢‘ï¼Œéƒ½ä¼šå½±å“å®šæ—¶å™¨ç²¾åº¦ã€‚
* ç»“æžœï¼šåŠ¨ç”»å¸§é—´éš”ä¸å‡åŒ€ï¼Œå‡ºçŽ° **æŠ–åŠ¨ (jank)**ã€‚

---

## 2. è®¡æ—¶å™¨ä¸Žå±å¹•åˆ·æ–°ä¸åŒæ­¥

* æ˜¾ç¤ºå™¨ä¸€èˆ¬ä»¥ **å›ºå®šåˆ·æ–°çŽ‡** æ¸²æŸ“ï¼ˆå¸¸è§ 60Hz â†’ æ¯ 16.67ms ä¸€å¸§ï¼‰ã€‚
* `setInterval(..., 16)` å¹¶ä¸ä¼šå’Œåˆ·æ–°æ—¶åˆ»å¯¹é½ï¼Œå®ƒå¯èƒ½åœ¨ä¸¤æ¬¡åˆ·æ–°ä¸­é—´è§¦å‘ã€‚
* ç»“æžœï¼š

  * æµè§ˆå™¨åªèƒ½ç­‰åˆ°ä¸‹æ¬¡åˆ·æ–°æ—¶å†æŠŠç»˜åˆ¶ç»“æžœæŽ¨åˆ°å±å¹•ã€‚
  * æœ‰äº›å¸§è¢«ä¸¢å¼ƒï¼Œäº§ç”Ÿ **å¡é¡¿å’Œæ’•è£‚æ„Ÿ**ã€‚

---

## 3. åŽå°æ ‡ç­¾é¡µå’ŒèŠ‚èƒ½æ¨¡å¼çš„é—®é¢˜

* åœ¨åŽå° tab æˆ–ç§»åŠ¨ç«¯çœç”µæ¨¡å¼ä¸‹ï¼š

  * `setInterval`/`setTimeout` ä¼šè¢«æµè§ˆå™¨ **å¼ºè¡Œé™é¢‘**ï¼Œç”šè‡³å»¶è¿Ÿåˆ° 1000msã€‚
  * åŠ¨ç”»å®Œå…¨å¤±çœŸæˆ–è·³å¸§ã€‚
* è€Œ `requestAnimationFrame` ä¼šåœ¨åŽå°è‡ªåŠ¨æš‚åœï¼Œæ¢å¤å‰å°æ—¶å†ç»§ç»­ï¼Œéžå¸¸èŠ‚èƒ½ã€‚

---

## 4. `requestAnimationFrame` çš„ä¼˜åŠ¿

çŽ°ä»£æµè§ˆå™¨æŽ¨èç”¨ rAFï¼Œä¸»è¦æœ‰ä¸‰å¤§å¥½å¤„ï¼š

1. **å’Œå±å¹•åˆ·æ–°åŒæ­¥**ï¼šæµè§ˆå™¨åœ¨å‡†å¤‡æ¸²æŸ“å‰è°ƒç”¨ rAFï¼Œä¿è¯åŠ¨ç”»åœ¨æœ€ä½³æ—¶æœºç»˜åˆ¶ã€‚
2. **æ›´æµç•…**ï¼šèƒ½æœ€å¤§åŒ–åˆ©ç”¨åˆ·æ–°çŽ‡ï¼ˆ60Hzã€120Hz æ˜¾ç¤ºå™¨éƒ½é€‚é…ï¼‰ã€‚
3. **èŠ‚èƒ½**ï¼šåŽå°è‡ªåŠ¨åœç”¨ï¼Œä¸æµªè´¹èµ„æºã€‚

---

## 5. ä¸¾ä¸ªå¯¹æ¯”ä¾‹å­

```js
// âŒ ç”¨è®¡æ—¶å™¨å®žçŽ°åŠ¨ç”»
function animateTimer(el) {
  let pos = 0;
  let timer = setInterval(() => {
    pos += 2;
    el.style.transform = `translateX(${pos}px)`;
    if (pos > 300) clearInterval(timer);
  }, 16);
}

// âœ… ç”¨ requestAnimationFrame å®žçŽ°åŠ¨ç”»
function animateRAF(el) {
  let pos = 0;
  function step() {
    pos += 2;
    el.style.transform = `translateX(${pos}px)`;
    if (pos <= 300) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}
```

* **è®¡æ—¶å™¨ç‰ˆæœ¬**ï¼šåœ¨ä½Žæ€§èƒ½æœºå™¨ã€åŽå° tab ä¸‹å®¹æ˜“æŽ‰å¸§ã€å¡é¡¿ã€‚
* **rAF ç‰ˆæœ¬**ï¼šä¿è¯ä¸Žå±å¹•åˆ·æ–°åŒæ­¥ï¼Œæµç•…è€Œç¨³å®šã€‚

---

âœ… æ€»ç»“ä¸€å¥è¯ï¼š
**JS åŠ¨ç”»ä¸èƒ½ç”¨è®¡æ—¶å™¨çš„æ ¹æœ¬åŽŸå› æ˜¯å®ƒæ— æ³•ä¸Žæµè§ˆå™¨æ¸²æŸ“ç®¡çº¿åŒæ­¥ï¼Œæ—¶é—´ç²¾åº¦ä¹Ÿä¸å¯é ï¼Œä¼šå¯¼è‡´åŠ¨ç”»ä¸æµç•…å’Œèƒ½è€—é«˜ã€‚æŽ¨èç”¨ `requestAnimationFrame` æˆ–è€… CSS åŠ¨ç”»ã€‚**


