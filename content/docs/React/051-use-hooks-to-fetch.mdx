---
title: å¦‚ä½•åœ¨ React é¡¹ç›®ä¸­ä½¿ç”¨ Hooks ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Ÿ
---

åœ¨ React é¡¹ç›®ä¸­ä½¿ç”¨ Hooks ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå¸¸è§çš„æ–¹å¼æ˜¯é€šè¿‡ `useEffect` ç»“åˆ `useState`ã€‚ä¸‹é¢æˆ‘å°†è¯¦ç»†è®²è§£æ¯ä¸ªå…³é”®ç‚¹ï¼š

---

## âœ… æ ¸å¿ƒ Hook ç®€ä»‹

1. **`useState`**ï¼šç”¨äºå­˜å‚¨æ•°æ®å’Œæ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚
2. **`useEffect`**ï¼šåœ¨ç»„ä»¶æŒ‚è½½æˆ–ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰§è¡Œå‰¯ä½œç”¨é€»è¾‘ï¼ˆæ¯”å¦‚å‘èµ·ç½‘ç»œè¯·æ±‚ï¼‰ã€‚

---

## ğŸ“¦ åŸºç¡€ç¤ºä¾‹ï¼šä½¿ç”¨ `fetch` è·å–æ•°æ®

```jsx
import React, { useEffect, useState } from 'react';

function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true); // åŠ è½½çŠ¶æ€
  const [error, setError] = useState(null);     // é”™è¯¯çŠ¶æ€

  useEffect(() => {
    async function fetchUsers() {
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/users');
        if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
        const data = await response.json();
        setUsers(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    fetchUsers();
  }, []); // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡

  if (loading) return <p>Loading...</p>;
  if (error) return <p>Error: {error}</p>;

  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

---

## ğŸ§  æ·±å…¥ç†è§£å…³é”®ç‚¹

### 1. `useEffect(() => { ... }, [])`

* ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç©ºæ•°ç»„ `[]`ï¼Œæ„å‘³ç€å‰¯ä½œç”¨åªåœ¨**ç»„ä»¶é¦–æ¬¡æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡**ã€‚
* ç±»ä¼¼äºç±»ç»„ä»¶ä¸­çš„ `componentDidMount`ã€‚

### 2. å¼‚æ­¥å‡½æ•°å¤„ç†

* ä¸èƒ½ç›´æ¥åœ¨ `useEffect` ä¸­ä½¿ç”¨ `async`ï¼Œéœ€è¦å†…éƒ¨å®šä¹‰å¼‚æ­¥å‡½æ•°å†è°ƒç”¨ã€‚

  ```js
  useEffect(() => {
    async function fetchData() {
      // await ...
    }
    fetchData();
  }, []);
  ```

---

## ğŸš¦ å®æˆ˜ä¸­å¸¸è§çš„å¢å¼ºç­–ç•¥

### âœ… æ·»åŠ åŠ è½½ä¸é”™è¯¯çŠ¶æ€

ä¸Šé¢çš„ä¾‹å­ä¸­ `loading` å’Œ `error` èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚

### âœ… é˜²æ­¢ç»„ä»¶å¸è½½åæ›´æ–°çŠ¶æ€ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰

```js
useEffect(() => {
  let isMounted = true;

  async function fetchData() {
    const res = await fetch(...);
    const data = await res.json();
    if (isMounted) {
      setUsers(data);
    }
  }

  fetchData();

  return () => {
    isMounted = false; // æ¸…ç†å‰¯ä½œç”¨
  };
}, []);
```

### âœ… å°è£…è¯·æ±‚é€»è¾‘ä¸ºè‡ªå®šä¹‰ Hookï¼ˆå¤ç”¨æ€§é«˜ï¼‰

```jsx
function useUsers() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch('https://jsonplaceholder.typicode.com/users')
      .then(res => res.json())
      .then(setUsers)
      .finally(() => setLoading(false));
  }, []);

  return { users, loading };
}
```

ç„¶åç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```jsx
function UserList() {
  const { users, loading } = useUsers();
  return loading ? <p>Loading...</p> : <ul>{users.map(...}</ul>;
}
```

---

## ğŸš€ ä½¿ç”¨æ›´å¼ºå¤§çš„æ•°æ®è·å–åº“ï¼ˆå¯é€‰ï¼‰

* [`axios`](https://axios-http.com/)
* [`react-query`](https://tanstack.com/query) / `@tanstack/react-query`
* [`swr`](https://swr.vercel.app/)

è¿™äº›åº“å¯ä»¥å¸®ä½ å¤„ç†ç¼“å­˜ã€é‡è¯•ã€é”™è¯¯å¤„ç†ã€åˆ†é¡µç­‰å¤æ‚åœºæ™¯ã€‚

---

## æ€»ç»“ï¼šæ•°æ®è¯·æ±‚çš„ Hook å†™æ³•æ ¸å¿ƒæ­¥éª¤

| æ­¥éª¤     | æè¿°                             |
| ------ | ------------------------------ |
| åˆå§‹åŒ–çŠ¶æ€  | ä½¿ç”¨ `useState` å®šä¹‰æ•°æ®ã€åŠ è½½ã€é”™è¯¯çŠ¶æ€     |
| å‘èµ·è¯·æ±‚   | åœ¨ `useEffect` ä¸­å‘èµ·è¯·æ±‚å¹¶æ›´æ–°çŠ¶æ€       |
| é”™è¯¯å¤„ç†   | ä½¿ç”¨ try/catch æˆ– `.catch()` æ•è·é”™è¯¯ |
| åŠ è½½çŠ¶æ€æç¤º | `loading` ä¸º true æ—¶æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨      |
| æ¸…ç†å‰¯ä½œç”¨  | `return` ä¸­æ¸…ç†æ ‡è®°é˜²æ­¢å†…å­˜æ³„æ¼           |

å¦‚æœä½ æœ‰æ›´å¤æ‚çš„åœºæ™¯ï¼ˆåˆ†é¡µã€ç¼“å­˜ã€é‡è¯•ï¼‰ï¼Œå¯ä»¥ç”¨ `react-query` æˆ– `swr`ï¼Œæˆ‘ä¹Ÿå¯ä»¥è¯¦ç»†ä»‹ç»å®ƒä»¬çš„ä½¿ç”¨ã€‚

---

ä¸‹é¢æ˜¯ç”¨ **React Queryï¼ˆ`@tanstack/react-query`ï¼‰** æ”¹å†™ä»æœåŠ¡ç«¯è·å–æ•°æ®çš„å®Œæ•´ä¾‹å­ï¼ŒåŠŸèƒ½å’Œä¹‹å‰ä¸€æ ·ï¼Œä½†æ›´åŠ ä¸“ä¸šã€å¥å£®å¹¶ä¸”è‡ªåŠ¨å¤„ç†ç¼“å­˜ã€çŠ¶æ€ç®¡ç†ã€è¯·æ±‚é‡è¯•ç­‰åŠŸèƒ½ã€‚

---

## ğŸ§± å®‰è£…ä¾èµ–

```bash
npm install @tanstack/react-query
```

---

## âœ… åŸºæœ¬ç”¨æ³•

### 1ï¸âƒ£ è®¾ç½® QueryClientProviderï¼ˆå…¨å±€åŒ…è£¹ï¼‰

ä½ éœ€è¦åœ¨ App çš„å…¥å£å¤„åŒ…è£¹ï¼š

```jsx
// main.jsx æˆ– App.jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import App from './App';

const queryClient = new QueryClient();

ReactDOM.createRoot(document.getElementById('root')).render(
  <QueryClientProvider client={queryClient}>
    <App />
  </QueryClientProvider>
);
```

---

### 2ï¸âƒ£ åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `useQuery`

```jsx
import { useQuery } from '@tanstack/react-query';

function fetchUsers() {
  return fetch('https://jsonplaceholder.typicode.com/users')
    .then(res => {
      if (!res.ok) throw new Error('ç½‘ç»œé”™è¯¯');
      return res.json();
    });
}

function UserList() {
  const {
    data: users,
    isLoading,
    isError,
    error,
  } = useQuery({
    queryKey: ['users'], // ç¼“å­˜ key
    queryFn: fetchUsers,
  });

  if (isLoading) return <p>Loading...</p>;
  if (isError) return <p>Error: {error.message}</p>;

  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

---

## ğŸ” ä¸ºä»€ä¹ˆç”¨ React Queryï¼Ÿ

| ç‰¹æ€§                    | æè¿°                      |
| --------------------- | ----------------------- |
| âœ… è‡ªåŠ¨ç¼“å­˜                | ç›¸åŒ `queryKey` ä¼šè‡ªåŠ¨å¤ç”¨æ•°æ®   |
| âœ… è‡ªåŠ¨ loading/error çŠ¶æ€ | å†…å»ºçš„çŠ¶æ€æ— éœ€è‡ªå·± `useState` ç®¡ç† |
| âœ… è¯·æ±‚é‡è¯•                | ç½‘ç»œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•               |
| âœ… åå°åˆ·æ–°                | é¡µé¢æ¿€æ´»åè‡ªåŠ¨é‡æ–°è¯·æ±‚æ•°æ®           |
| âœ… åˆ†é¡µã€æ‡’åŠ è½½ç­‰æ‰©å±•æ€§å¼º         | æ˜“äºå°è£…å¤æ‚é€»è¾‘                |

---

## ğŸ“¦ è¿›é˜¶å°è£…ï¼šåˆ›å»º `useUsers` è‡ªå®šä¹‰ Hook

```jsx
import { useQuery } from '@tanstack/react-query';

function fetchUsers() {
  return fetch('https://jsonplaceholder.typicode.com/users')
    .then(res => res.json());
}

export function useUsers() {
  return useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers,
  });
}
```

ç„¶ååœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```jsx
import { useUsers } from './hooks/useUsers';

function UserList() {
  const { data: users, isLoading, isError } = useUsers();

  if (isLoading) return <p>Loading...</p>;
  if (isError) return <p>è¯·æ±‚å¤±è´¥</p>;

  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

---

## ğŸ§  å°è´´å£«

* æ”¯æŒ refetchã€pollingã€æ‡’åŠ è½½ã€åˆ†é¡µç­‰ã€‚
* å¯ä»¥å’Œ Axios ç»“åˆä½¿ç”¨ï¼š`queryFn: () => axios.get(...).then(res => res.data)`ã€‚
* DevTools è°ƒè¯•å·¥å…·ï¼š`npm i @tanstack/react-query-devtools` å¯è§†åŒ–æ•°æ®ç¼“å­˜ã€‚

---

å¦‚æœä½ éœ€è¦æ”¯æŒ **åˆ†é¡µ**ã€**æœç´¢å‚æ•°**ã€**æ‡’åŠ è½½ï¼ˆinfinite scrollï¼‰**ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»§ç»­ç¤ºä¾‹ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
