---
title: React çš„ render å‡½æ•°åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«è§¦å‘ï¼Ÿ
---

åœ¨ React ä¸­ï¼Œç»„ä»¶çš„ `render` å‡½æ•°æ˜¯ç”¨äº**æè¿° UI åº”è¯¥é•¿ä»€ä¹ˆæ ·**çš„å‡½æ•°ï¼Œå®ƒçš„æ‰§è¡Œä¼šè¿”å› JSX å…ƒç´ ï¼ŒReact ä¼šæ ¹æ®å®ƒçš„è¿”å›å€¼æ¥æ„å»ºè™šæ‹Ÿ DOMï¼Œç„¶åé€šè¿‡ diff ç®—æ³•å¯¹æ¯”å¹¶æ›´æ–°çœŸå® DOMã€‚

---

### ä¸€ã€render å‡½æ•°çš„è§¦å‘æ—¶æœº

`render()` ä¼šåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸­è¢« **è‡ªåŠ¨è§¦å‘**ï¼š

---

#### 1. **ç»„ä»¶é¦–æ¬¡æŒ‚è½½ï¼ˆMountï¼‰æ—¶**

å½“ç»„ä»¶ç¬¬ä¸€æ¬¡è¢«æ¸²æŸ“åˆ° DOM ä¸Šæ—¶ï¼ˆä¹Ÿå°±æ˜¯ç»„ä»¶ä»æ— åˆ°æœ‰ï¼‰ï¼Œ`render` å‡½æ•°ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚

```jsx
class MyComponent extends React.Component {
  render() {
    console.log('render called');
    return <div>Hello</div>;
  }
}
// ç¬¬ä¸€æ¬¡åŠ è½½ <MyComponent /> æ—¶ render ä¼šè¢«è°ƒç”¨
```

---

#### 2. **ç»„ä»¶çš„ state æˆ– props æ”¹å˜æ—¶**

* å½“ç»„ä»¶å†…éƒ¨è°ƒç”¨ `this.setState()`ï¼Œä¼šæ›´æ–°çŠ¶æ€ï¼Œè§¦å‘é‡æ–° renderã€‚
* å½“çˆ¶ç»„ä»¶ä¼ å…¥çš„ `props` å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¼šè§¦å‘ renderã€‚

```jsx
class Counter extends React.Component {
  state = { count: 0 };

  increment = () => {
    this.setState({ count: this.state.count + 1 }); // ä¼šè§¦å‘ render
  };

  render() {
    return <button onClick={this.increment}>{this.state.count}</button>;
  }
}
```

---

#### 3. **è°ƒç”¨ `forceUpdate()` æ—¶**

è™½ç„¶ä¸æ¨èï¼Œä½†å¯ä»¥é€šè¿‡ `forceUpdate()` å¼ºåˆ¶è§¦å‘ç»„ä»¶çš„ render å‡½æ•°ï¼ˆè·³è¿‡ `shouldComponentUpdate`ï¼‰ã€‚

```jsx
this.forceUpdate(); // ä¼šå¼ºåˆ¶è°ƒç”¨ render
```

---

#### 4. **çˆ¶ç»„ä»¶ render å¯¼è‡´å­ç»„ä»¶ render**

å³ä½¿å­ç»„ä»¶çš„ props æ²¡å˜ï¼Œåªè¦çˆ¶ç»„ä»¶ render äº†ï¼Œå­ç»„ä»¶é»˜è®¤ä¹Ÿä¼š renderï¼ˆé™¤éè¢« `React.memo`ã€`PureComponent`ã€`shouldComponentUpdate` ç­‰ä¼˜åŒ–é˜»æ­¢ï¼‰ã€‚

---

### äºŒã€ä¸ä¼šè§¦å‘ render çš„æƒ…å†µ

* **ä¸ç›´æ¥ä¿®æ”¹ state çš„æƒ…å†µä¸‹ setState ä¸ä¼šç”Ÿæ•ˆ**

```js
this.state.count = 2; // ä¸ä¼šè§¦å‘ render
```

* **setState è®¾ç½®ç›¸åŒçš„å€¼**
  å¦‚æœä½ ç”¨ `setState` è®¾ç½®çš„å€¼å’Œå½“å‰ state ç›¸åŒï¼ŒReact ä¼šè·³è¿‡æ›´æ–°ï¼ˆæµ…æ¯”è¾ƒï¼‰ã€‚

* **`shouldComponentUpdate` è¿”å› false**
  åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå¦‚æœä½ é‡å†™ `shouldComponentUpdate` å¹¶è¿”å› falseï¼Œä¼šé˜»æ­¢ renderã€‚

* **PureComponent å‘ç°æ²¡æœ‰å˜åŒ–**
  å¦‚æœç»„ä»¶ç»§æ‰¿äº† `React.PureComponent`ï¼Œå®ƒä¼šè‡ªåŠ¨å¯¹ props å’Œ state è¿›è¡Œæµ…æ¯”è¾ƒï¼Œå‘ç°æ²¡å˜å°±ä¸ä¼š renderã€‚

---

### ä¸‰ã€æ‰§è¡Œé¡ºåºç›¸å…³

åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ`render()` å‡½æ•°ä½äºä¸­é—´ç¯èŠ‚ï¼š

1. åˆå§‹åŒ–é˜¶æ®µï¼š`constructor` â†’ `render` â†’ `componentDidMount`
2. æ›´æ–°é˜¶æ®µï¼ˆå¦‚ setStateï¼‰ï¼š`shouldComponentUpdate` â†’ `render` â†’ `componentDidUpdate`
3. å¸è½½é˜¶æ®µï¼š`componentWillUnmount`ï¼ˆä¸è§¦å‘ renderï¼‰

---

### å››ã€æ€»ç»“

| è§¦å‘æ–¹å¼                                    | æ˜¯å¦è§¦å‘ render |
| --------------------------------------- | ----------- |
| åˆæ¬¡åŠ è½½                                    | âœ…           |
| è°ƒç”¨ `setState()`                         | âœ…ï¼ˆé™¤éå€¼æ²¡å˜ï¼‰    |
| çˆ¶ç»„ä»¶æ›´æ–°ï¼ˆå³ä½¿ props ä¸å˜ï¼‰                      | âœ…ï¼ˆé™¤éä¼˜åŒ–æ‹¦æˆªï¼‰   |
| è°ƒç”¨ `forceUpdate()`                      | âœ…           |
| ç›´æ¥ä¿®æ”¹ state                              | âŒ           |
| `shouldComponentUpdate()` è¿”å› false      | âŒ           |
| ä½¿ç”¨ `React.memo` æˆ– `PureComponent` åˆ¤æ–­æ— å˜åŒ– | âŒ           |

---

åœ¨ React ä¸­ï¼Œ**é¿å…ä¸å¿…è¦çš„ renderï¼ˆé‡æ–°æ¸²æŸ“ï¼‰** æ˜¯æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ‰‹æ®µï¼Œå°¤å…¶åœ¨å¤§å‹ç»„ä»¶æ ‘ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§ä¸”æœ‰æ•ˆçš„ç­–ç•¥ï¼š

---

## âœ… 1. ä½¿ç”¨ `React.memo`ï¼ˆå‡½æ•°ç»„ä»¶è®°å¿†åŒ–ï¼‰

`React.memo` ä¼šå¯¹ç»„ä»¶çš„ `props` è¿›è¡Œæµ…æ¯”è¾ƒï¼Œåªæœ‰ props å˜åŒ–æ—¶æ‰ä¼šé‡æ–°æ¸²æŸ“ã€‚

```jsx
const MyComponent = React.memo(function MyComponent({ name }) {
  console.log('rendered');
  return <div>{name}</div>;
});
```

> é€‚ç”¨äºçº¯å‡½æ•°ç»„ä»¶ï¼Œå°¤å…¶æ˜¯ UI å‘ˆç°ç»„ä»¶ã€‚

---

## âœ… 2. ä½¿ç”¨ `useMemo` å’Œ `useCallback`

* `useMemo`ï¼šè®°å¿†è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
* `useCallback`ï¼šè®°å¿†å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å­ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

```jsx
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);

const memoizedCallback = useCallback(() => {
  doSomething(a, b);
}, [a, b]);
```

> ç”¨äºä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°æˆ–å€¼ï¼Œä¸åŠ ä¼šå¯¼è‡´å­ç»„ä»¶é‡æ–° renderã€‚

---

## âœ… 3. ä½¿ç”¨ `shouldComponentUpdate`ï¼ˆç±»ç»„ä»¶ï¼‰

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå¯ä»¥é‡å†™è¯¥ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å†³å®šæ˜¯å¦æ›´æ–°ï¼š

```jsx
shouldComponentUpdate(nextProps, nextState) {
  return nextProps.value !== this.props.value;
}
```

> æˆ–è€…ä½¿ç”¨ `PureComponent` æ›¿ä»£æ‰‹åŠ¨æ¯”è¾ƒã€‚

---

## âœ… 4. ä½¿ç”¨ `React.PureComponent`

ç±»ç»„ä»¶ç‰ˆæœ¬çš„ `React.memo`ï¼Œè‡ªåŠ¨è¿›è¡Œæµ…æ¯”è¾ƒã€‚

```jsx
class MyComponent extends React.PureComponent {
  render() {
    return <div>{this.props.name}</div>;
  }
}
```

---

## âœ… 5. æ‹†åˆ†ç»„ä»¶ã€æå‡ç²’åº¦

å°†å¤§ç»„ä»¶æ‹†åˆ†æˆæ›´å°çš„ç‹¬ç«‹ç»„ä»¶ï¼Œæ§åˆ¶æ¯ä¸ªç»„ä»¶åªå…³æ³¨è‡ªå·±çš„ props å’ŒçŠ¶æ€å˜åŒ–ï¼Œä»è€Œé™ä½é‡æ¸²æŸ“æ¦‚ç‡ã€‚

---

## âœ… 6. çŠ¶æ€æå‡ï¼ˆLifting State Upï¼‰

é¿å…åœ¨çˆ¶ç»„ä»¶ä¸­ç»´æŠ¤è¿‡å¤šçŠ¶æ€ï¼Œå¦åˆ™ä¼šå¯¼è‡´å­ç»„ä»¶å…¨éƒ¨é‡æ¸²æŸ“ã€‚

---

## âœ… 7. ä½¿ç”¨ç¨³å®šå¼•ç”¨çš„ propsï¼ˆå¦‚ contextï¼‰

ä¾‹å¦‚ `useContext`ï¼Œå¦‚æœ context provider æ¯æ¬¡éƒ½æä¾›æ–°å€¼ï¼Œä¼šè§¦å‘æ‰€æœ‰è®¢é˜…ç»„ä»¶æ›´æ–°ã€‚è§£å†³æ–¹æ³•ï¼š

```jsx
const value = useMemo(() => ({ theme, toggleTheme }), [theme]);
<ThemeContext.Provider value={value}>
```

---

## âœ… 8. é¿å…åœ¨ render ä¸­åˆ›å»ºæ–°å¯¹è±¡/å‡½æ•°

ä»¥ä¸‹å†™æ³•ä¼šå¯¼è‡´å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼š

```jsx
<MyComponent data={{ id: 1 }} /> // æ¯æ¬¡ render éƒ½æ˜¯æ–°å¯¹è±¡
```

> åº”è¯¥ç”¨ `useMemo` æˆ–å¤–éƒ¨å®šä¹‰ç¨³å®šæ•°æ®ã€‚

---

## âœ… 9. ä½¿ç”¨è™šæ‹ŸåŒ–ï¼ˆVirtualizationï¼‰

æ¯”å¦‚ `react-window`ã€`react-virtualized` ç­‰åº“ï¼Œé¿å…ä¸€æ¬¡æ€§æ¸²æŸ“å¤§é‡åˆ—è¡¨é¡¹ï¼Œä»è€Œå‡è½» render è´Ÿæ‹…ã€‚

---

### ğŸš« å¸¸è§è¯¯åŒº

| è¯¯åŒº                         | åŸå›                                                            |
| -------------------------- | ------------------------------------------------------------ |
| è®¤ä¸ºåªä½¿ç”¨ `React.memo` å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ | å®ƒåªåšæµ…æ¯”è¾ƒï¼Œå¤æ‚å¯¹è±¡è¿˜æ˜¯ä¼šå˜åŒ–                                             |
| ä»¥ä¸ºçŠ¶æ€æ²¡å˜å°±ä¸ä¼š render           | React ä¼šå°è¯• renderï¼Œä¸€æ—¦ `setState` è°ƒç”¨ï¼Œå“ªæ€•æ˜¯ä¸€æ ·çš„å€¼ï¼Œä¹Ÿä¼šè§¦å‘ renderï¼ˆé™¤éæœ‰ä¼˜åŒ–ï¼‰ |

---

### ğŸ” è¯Šæ–­å·¥å…·

* React DevTools > Profiler tabï¼šæŸ¥çœ‹å“ªäº›ç»„ä»¶é¢‘ç¹ render
* `why-did-you-render`ï¼šç¬¬ä¸‰æ–¹åº“ï¼Œç”¨æ¥æ£€æµ‹ç»„ä»¶æ˜¯å¦ä¸å¿…è¦åœ° render

---

éœ€è¦å…·ä½“åº”ç”¨å“ªç§ç­–ç•¥ï¼Œå¯ä»¥æ ¹æ®ä½ çš„åº”ç”¨åœºæ™¯å‘æˆ‘ä¸€æ®µä»£ç ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†æå“ªé‡Œå¯ä»¥é¿å… renderã€‚

