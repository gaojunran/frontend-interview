---
title: ä»€ä¹ˆæ˜¯ Suspense ç»„ä»¶ï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
---

`<Suspense>` æ˜¯ React æä¾›çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œç”¨äºå¤„ç†ç»„ä»¶ã€ŒåŠ è½½çŠ¶æ€ã€çš„æ˜¾ç¤ºï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨**ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰**å’Œ**å¼‚æ­¥æ•°æ®åŠ è½½**çš„åœºæ™¯ä¸‹ã€‚

---

## ä¸€ã€Suspense æ˜¯ä»€ä¹ˆï¼Ÿ

`<Suspense>` ä¸»è¦ç”¨äº**ç­‰å¾…å­ç»„ä»¶ä¸­çš„æŸäº›æ“ä½œå®Œæˆå†æ¸²æŸ“ UI**ï¼Œå¹¶åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­**æ˜¾ç¤ºä¸€ä¸ªåå¤‡ UIï¼ˆfallback UIï¼‰**ï¼Œæ¯”å¦‚åŠ è½½åŠ¨ç”»æˆ–å ä½ç¬¦ã€‚

åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

```jsx
import React, { Suspense, lazy } from 'react';

const MyComponent = lazy(() => import('./MyComponent'));

function App() {
  return (
    <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
      <MyComponent />
    </Suspense>
  );
}
```

---

## äºŒã€Suspense è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

### âœ… é—®é¢˜ä¸€ï¼šä»£ç åˆ†å‰²æ—¶åŠ è½½è¿‡ç¨‹ä¸å¯æ§

åœ¨ä½¿ç”¨ `React.lazy()` è¿›è¡Œä»£ç åˆ†å‰²æ—¶ï¼Œç»„ä»¶å˜æˆäº†å¼‚æ­¥åŠ è½½ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ â€”â€” é¡µé¢ä¼šç©ºç™½ï¼Œæ— æ³•æç¤ºåŠ è½½çŠ¶æ€ã€‚

> **è§£å†³æ–¹æ¡ˆï¼š** `Suspense` èƒ½è®©ä½ æŒ‡å®šä¸€ä¸ª fallback ç»„ä»¶ï¼Œåœ¨å¼‚æ­¥åŠ è½½ç»„ä»¶æœŸé—´æ¸²æŸ“è¿™ä¸ª fallbackã€‚

---

### âœ… é—®é¢˜äºŒï¼šå¼‚æ­¥æ•°æ®è·å–ï¼ˆé…åˆ React 18 çš„ Concurrent æ¨¡å¼ï¼‰

ä»¥å‰æˆ‘ä»¬åœ¨è¯·æ±‚æ•°æ®æ—¶éœ€è¦è¿™æ ·å¤„ç†ï¼š

```jsx
useEffect(() => {
  fetchData().then(setData)
}, []);
```

ä½†è¿™ä¼šäº§ç”ŸçŠ¶æ€é—ªçƒã€åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†åˆ†æ•£çš„é—®é¢˜ã€‚

> **è§£å†³æ–¹æ¡ˆï¼š** React 18 ä¸­é…åˆ **`Suspense` + `use` Hookï¼ˆæˆ– `react-query`, Relay ç­‰ï¼‰**ï¼Œå¯ä»¥è®©ä½ **åœ¨ç»„ä»¶çº§åˆ«å¤„ç†å¼‚æ­¥æ•°æ®ï¼Œè‡ªåŠ¨æŒ‚èµ·ç­‰å¾…æ•°æ®å®Œæˆåå†æ¸²æŸ“ç»„ä»¶**ã€‚

---

## ä¸‰ã€ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹

### 1. ä»£ç åˆ†å‰²

```jsx
const LazyPage = lazy(() => import('./HeavyPage'));

<Suspense fallback={<Spinner />}>
  <LazyPage />
</Suspense>
```

### 2. å¼‚æ­¥æ•°æ®åŠ è½½ï¼ˆReact 18+ï¼‰

å‡è®¾ä½ æœ‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•° `getData()`ï¼š

```jsx
const promise = getData(); // ä¼šè¿”å›ä¸€ä¸ª promise

function DataComponent() {
  const data = use(promise); // React 18 çš„ use
  return <div>{data.title}</div>;
}

<Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
  <DataComponent />
</Suspense>
```

---

## å››ã€Suspense çš„é™åˆ¶

1. `Suspense` ç›®å‰åªæ”¯æŒ**éƒ¨åˆ†å¼‚æ­¥åœºæ™¯**ï¼š

   * âœ… æ”¯æŒï¼š`React.lazy`ã€Relayã€React Server Componentsï¼ˆRSCï¼‰ã€React 18 çš„ `use()`ã€‚
   * âŒ ä¸æ”¯æŒï¼šè‡ªå®šä¹‰å¼‚æ­¥ç»„ä»¶ï¼ˆé™¤éç”¨åƒ `react-query` æˆ– `swr` ç­‰åº“é›†æˆï¼‰ã€‚

2. `Suspense` å¿…é¡»æ­é…åˆé€‚çš„æ•°æ®å±‚æˆ– APIï¼ˆå¦‚ `lazy()` æˆ– `use()`ï¼‰æ‰èƒ½å·¥ä½œã€‚

---

## äº”ã€è¿›é˜¶ç”¨æ³•ï¼šåµŒå¥— Suspense

å¯ä»¥åµŒå¥—å¤šä¸ª `Suspense` æ¥å®ç°ã€Œæ¸è¿›å¼åŠ è½½ã€ï¼Œå³å±€éƒ¨åŒºåŸŸå…ˆåŠ è½½å¥½å°±å…ˆå±•ç¤ºï¼š

```jsx
<Suspense fallback={<div>æ•´ä½“åŠ è½½ä¸­</div>}>
  <Header />
  <Suspense fallback={<div>æ–‡ç« åŠ è½½ä¸­...</div>}>
    <Article />
  </Suspense>
  <Suspense fallback={<div>è¯„è®ºåŠ è½½ä¸­...</div>}>
    <Comments />
  </Suspense>
</Suspense>
```

---

## å…­ã€æ€»ç»“

| é¡¹ç›® | å†…å®¹                                         |
| -- | ------------------------------------------ |
| åç§° | `<Suspense>`                               |
| ç±»å‹ | React å†…ç½®ç»„ä»¶                                 |
| ä½œç”¨ | å¼‚æ­¥ç»„ä»¶æˆ–æ•°æ®åŠ è½½æ—¶æ˜¾ç¤º fallback UI                   |
| é€‚ç”¨ | ä»£ç åˆ†å‰²ã€å¼‚æ­¥æ•°æ®è·å–ï¼ˆReact 18+ï¼‰                     |
| ä¼˜åŠ¿ | æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€æ›´å¹²å‡€çš„å¼‚æ­¥å¤„ç†æµç¨‹                         |
| ä¾èµ– | é€šå¸¸ä¸ `React.lazy`ã€`use()`ã€`react-query` ç­‰æ­é… |

---

`use()` æ˜¯ **React 18 æ–°å¢çš„å®éªŒæ€§ Hook**ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯ï¼š

> ğŸ‘‰ **åœ¨ç»„ä»¶ä¸­ç›´æ¥ã€Œç­‰å¾…å¼‚æ­¥æ•°æ®ã€æˆ–ã€Œå¼‚æ­¥èµ„æºã€ï¼Œä½¿å¾— Suspense èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†æŒ‚èµ·å’Œæ¸²æŸ“é€»è¾‘ã€‚**

å®ƒè®©å¼‚æ­¥èµ„æºå˜æˆåƒåŒæ­¥ä»£ç ä¸€æ ·ä½¿ç”¨ï¼Œ**ä¸å†éœ€è¦æ‰‹åŠ¨å¤„ç† loading/error çŠ¶æ€**ã€‚

---

## ä¸€ã€`use()` æ˜¯ä»€ä¹ˆï¼Ÿ

`use()` æ¥æ”¶ä¸€ä¸ª Promise æˆ–èµ„æºå¯¹è±¡ï¼ˆå¦‚ fetch çš„ Responseã€æ•°æ®ç¼“å­˜ç­‰ï¼‰ï¼Œå¦‚æœè¿™ä¸ªèµ„æºè¿˜æ²¡å‡†å¤‡å¥½ï¼Œå®ƒå°±ä¼šè®©ç»„ä»¶â€œæŒ‚èµ·â€ï¼Œç„¶åè§¦å‘æœ€è¿‘çš„ `<Suspense>`ï¼Œåœ¨æ•°æ®å‡†å¤‡å¥½ä¹‹åå†è‡ªåŠ¨æ¢å¤æ¸²æŸ“ã€‚

### è¯­æ³•ï¼š

```jsx
const data = use(promise);
```

âš ï¸ æ³¨æ„ï¼šç›®å‰ `use()` æ˜¯**å®éªŒæ€§ç‰¹æ€§**ï¼Œä»…åœ¨ï¼š

* React 18+
* æœåŠ¡ç«¯ç»„ä»¶ï¼ˆRSCï¼‰
* æˆ–å¯ç”¨ç‰¹å®šæ„å»ºé…ç½®ï¼ˆå¦‚ Next.js App Routerï¼‰
* æˆ–é…åˆç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ React Query + `useSuspenseQuery`ï¼‰

---

## äºŒã€`use()` èƒ½åšä»€ä¹ˆï¼Ÿ

### âœ… 1. ç­‰å¾…å¼‚æ­¥æ•°æ®ï¼ˆPromiseï¼‰

```jsx
const userPromise = fetch('/api/user').then(res => res.json());

function UserInfo() {
  const user = use(userPromise);
  return <div>{user.name}</div>;
}
```

å½“ `userPromise` æœªå®Œæˆæ—¶ï¼Œä¼šè®©ç»„ä»¶ã€ŒæŒ‚èµ·ã€ï¼Œ`<Suspense>` å°±èƒ½æ˜¾ç¤º fallbackï¼Œç­‰æ•°æ®å‡†å¤‡å¥½åè‡ªåŠ¨é‡æ–°æ¸²æŸ“ã€‚

---

### âœ… 2. é…åˆæ•°æ®ç¼“å­˜ï¼ˆReact Queryï¼‰

å¦‚æœä½¿ç”¨ React Queryï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ Suspenseï¼š

```tsx
function User() {
  const { data } = useSuspenseQuery(['user'], fetchUser);
  return <div>{data.name}</div>;
}
```

è¿™é‡Œ React Query ä¼šè¿”å›ä¸€ä¸ª Suspense-aware çš„æ•°æ®èµ„æºï¼Œè‡ªåŠ¨é€‚é… `use()` æœºåˆ¶ã€‚

---

### âœ… 3. ç”¨äºæœåŠ¡å™¨ç»„ä»¶ï¼ˆServer Componentsï¼‰

åœ¨ React çš„ Server Components ä¸­ï¼Œ`use()` èƒ½ç”¨äºç­‰å¾… fetch ç»“æœï¼š

```jsx
export default function Page() {
  const user = use(fetch('https://api.example.com/user').then(res => res.json()));
  return <h1>{user.name}</h1>;
}
```

---

## ä¸‰ã€ä¸ºä»€ä¹ˆ `use()` å¾ˆé‡è¦ï¼Ÿ

| ç‰¹æ€§     | ä¼ ç»Ÿæ–¹å¼ï¼ˆuseEffectï¼‰      | æ–°æ–¹å¼ï¼ˆuseï¼‰           |
| ------ | -------------------- | ------------------ |
| å†™æ³•     | å¼‚æ­¥é€»è¾‘åˆ†ç¦»ã€éœ€è¦å¤šæ¬¡ render   | æ›´åŠ åŒæ­¥ã€é€»è¾‘æ¸…æ™°          |
| çŠ¶æ€ç®¡ç†   | éœ€è¦ç»´æŠ¤ loading / error | è‡ªåŠ¨æŒ‚èµ·ã€ç”± Suspense å¤„ç† |
| SSR æ”¯æŒ | å¤æ‚ï¼Œæ‰‹åŠ¨æ³¨æ°´              | å¤©ç„¶æ”¯æŒï¼ˆé€‚åˆ RSCï¼‰       |
| å¹¶å‘æ¸²æŸ“æ”¯æŒ | ä¸ä½³                   | âœ… å†…å»ºå¹¶å‘æ”¯æŒ           |

---

## å››ã€ä½¿ç”¨æ³¨æ„äº‹é¡¹

* `use()` åªèƒ½åœ¨ **å‡½æ•°ç»„ä»¶é¡¶å±‚**ä½¿ç”¨ã€‚
* `use()` åªèƒ½åœ¨ **React 18+ çš„ç¯å¢ƒä¸­**ä½¿ç”¨ã€‚
* æ¨èé…åˆ `<Suspense>` ä½¿ç”¨ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®å¤„ç†æŒ‚èµ·çŠ¶æ€ã€‚
* åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ `use()` ä»å¤„äºå®éªŒé˜¶æ®µï¼ˆæ¨èç”¨ React Query è¿™ç§å°è£…ï¼‰ã€‚

---

## äº”ã€å°ç»“

| é¡¹ç›®   | å†…å®¹                                           |
| ---- | -------------------------------------------- |
| åç§°   | `use()`                                      |
| ç±»å‹   | å®éªŒæ€§ React Hook                               |
| å¼•å…¥ç‰ˆæœ¬ | React 18                                     |
| ä½œç”¨   | ç›´æ¥ç­‰å¾… Promise / å¼‚æ­¥èµ„æºï¼Œè‡ªåŠ¨ä¸ Suspense ååŒ          |
| ä¼˜ç‚¹   | å¼‚æ­¥å˜åŒæ­¥å†™æ³•ï¼Œæ›´å¹²å‡€ã€å¯è¯»æ€§å¼º                             |
| æ­é…ä½¿ç”¨ | `<Suspense>`ã€React Queryã€Server Components ç­‰ |

---

