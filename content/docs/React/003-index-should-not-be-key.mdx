---
title: 为什么在 React 遍历时不建议使用索引作为唯一的 key 值？
---

在 React 中遍历列表渲染组件时，**不建议使用索引（index）作为唯一的 `key` 值**，原因主要涉及性能优化和组件状态管理。下面详细讲讲为什么：

---

## 🔑 1. React 使用 key 来识别元素

在进行列表渲染时，React 使用 `key` 来追踪哪些元素改变、添加或删除。这有助于提升虚拟 DOM 的**diff 效率**，从而实现**高性能渲染**。

---

## 🚨 2. 使用索引作为 key 的问题

### ✅ 场景一：索引作为 key 没有问题的情况

当列表**静态且永远不变**（不添加、不删除、不排序）时，使用索引作为 key 是**安全的**，因为每一项的顺序始终保持一致。

### ❌ 场景二：列表发生变动时的问题

当列表项被插入、删除、重新排序时，使用索引作为 key 会带来以下问题：

---

### ❗1. 状态错乱问题

React 会复用同样 key 的组件实例。如果 key 是索引，删除/插入一个项会使后面的组件 key 全部错位，导致组件错误复用、状态错乱。

#### 举例：

```jsx
const [items, setItems] = useState(['A', 'B', 'C']);

items.map((item, index) => <Input key={index} defaultValue={item} />);
```

如果你删除了 `B`：

* `C` 的 index 从 `2` 变成 `1`，React 会以为 `C` 组件还是原来的 `B`。
* 如果 `Input` 是非受控组件（比如有内部状态），就会出现\*\*“输入框内容没变，但 state 变了”的现象\*\*。

---

### ❗2. 性能下降

当 key 变化（即使只是索引变了），React 会将对应节点销毁后重新创建，导致：

* 失去 diff 算法的性能优化；
* 不必要的组件重新挂载。

---

### ❗3. 动画/过渡异常

使用索引作为 key 时，React 无法准确识别哪个元素在动画前后是同一个，可能导致：

* 动画中断或闪烁；
* 元素出现错位效果。

---

## ✅ 正确做法：使用稳定且唯一的 ID 作为 key

理想情况下，应使用具有业务含义的唯一标识符（如数据库中的 `id`）作为 key：

```jsx
items.map(item => <Input key={item.id} defaultValue={item.name} />);
```

这样即使插入、删除或排序，React 也能准确识别每一个组件。

---

## ✅ 小结

| 使用索引作为 key 的问题 | 原因             |
| -------------- | -------------- |
| 状态错乱           | key 错误导致组件错误复用 |
| 性能差            | diff 失败，导致重渲染  |
| 动画异常           | 无法正确追踪元素变化     |

**除非列表永远不变，否则建议不要用索引作为 key。**

