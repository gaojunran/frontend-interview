---
title: å¦‚æœ React çš„ Consumer ç»„ä»¶åœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­æ‰¾ä¸åˆ° Providerï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ
---

åœ¨ React ä¸­ï¼Œ`Consumer` æ˜¯ç”¨äºè®¢é˜…ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰å˜åŒ–çš„ç»„ä»¶ã€‚å¦‚æœåœ¨ç»„ä»¶æ ‘ä¸­ä½¿ç”¨äº† `Consumer`ï¼Œä½†å…¶ä¸Šå±‚æ²¡æœ‰å¯¹åº”çš„ `Provider`ï¼ŒReact ä¼šé‡‡ç”¨ä¸€ç§**é»˜è®¤å€¼æœºåˆ¶**æ¥å¤„ç†è¿™ä¸ªæƒ…å†µã€‚

---

### ğŸ§  å…³é”®æ¦‚å¿µ

React çš„ Context ç³»ç»Ÿæ˜¯é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªç»„ä»¶ç»„æˆçš„ï¼š

* `React.createContext(defaultValue)` ä¼šåˆ›å»ºï¼š

  * ä¸€ä¸ª `Provider`ï¼šç”¨äºæä¾› context å€¼
  * ä¸€ä¸ª `Consumer`ï¼šç”¨äºè¯»å– context å€¼

ä¾‹å¦‚ï¼š

```jsx
const MyContext = React.createContext('é»˜è®¤å€¼');
const { Provider, Consumer } = MyContext;
```

---

### âœ… å¦‚æœæ²¡æœ‰ Providerï¼ŒConsumer ä¼šä½¿ç”¨ `createContext` æ—¶æä¾›çš„é»˜è®¤å€¼

```jsx
const MyContext = React.createContext('é»˜è®¤å€¼');

function App() {
  return (
    <MyContext.Consumer>
      {value => <div>Context å€¼æ˜¯ï¼š{value}</div>}
    </MyContext.Consumer>
  );
}
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç”±äº `App` ä¸­æ²¡æœ‰åŒ…è£¹ `Provider`ï¼Œæ‰€ä»¥ `Consumer` ç»„ä»¶ä¼šä½¿ç”¨ `'é»˜è®¤å€¼'` ä½œä¸ºä¸Šä¸‹æ–‡å€¼ï¼Œç»“æœé¡µé¢æ˜¾ç¤ºï¼š

```
Context å€¼æ˜¯ï¼šé»˜è®¤å€¼
```

---

### ğŸ” å®é™…åº”ç”¨åœºæ™¯

è¿™ç§è¡Œä¸ºæ˜¯æœ‰ç”¨çš„ï¼Œå°¤å…¶åœ¨**ç»„ä»¶å¯å¤ç”¨**çš„æƒ…å†µä¸‹ã€‚ç»„ä»¶ä¸ä¾èµ–å¤–éƒ¨å¿…é¡»æä¾› `Provider` æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œå¢å¼ºäº†å®¹é”™æ€§ã€‚

```jsx
function ThemeButton() {
  return (
    <ThemeContext.Consumer>
      {theme => <button className={theme}>æŒ‰é’®</button>}
    </ThemeContext.Consumer>
  );
}

// å³ä½¿æ²¡æœ‰ Providerï¼Œä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨
```

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **é»˜è®¤å€¼åº”åˆç†è®¾ç½®**ï¼šå¦‚æœä¸å¸Œæœ›ç»„ä»¶è„±ç¦» Provider å·¥ä½œï¼Œé»˜è®¤å€¼å¯ä»¥æ˜¯ `null` æˆ–ç‰¹æ®Šæ ‡è®°ï¼Œç„¶åæ‰‹åŠ¨æŠ¥é”™ã€‚

   ```jsx
   const UserContext = React.createContext(null);

   function UserProfile() {
     return (
       <UserContext.Consumer>
         {user => {
           if (!user) throw new Error("UserProfile å¿…é¡»åœ¨ UserContext.Provider å†…ä½¿ç”¨");
           return <div>æ¬¢è¿ {user.name}</div>;
         }}
       </UserContext.Consumer>
     );
   }
   ```

2. **ä¸è¦æ»¥ç”¨é»˜è®¤å€¼**ï¼šé»˜è®¤å€¼åº”å½“æ˜¯ fallbackï¼ˆå¤‡ç”¨ï¼‰ï¼Œè€Œä¸æ˜¯æ›¿ä»£ Providerã€‚

---

### ğŸ”„ æ¨èåšæ³•

* åœ¨è®¾è®¡ç»„ä»¶æ—¶ï¼Œæ˜ç¡®æ˜¯å¦å…è®¸æ²¡æœ‰ Provider çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚
* å¦‚æœå¿…é¡»ä¾èµ– Providerï¼Œä½¿ç”¨ `useContext` + æŠ¥é”™é€»è¾‘æ›´åˆé€‚ï¼ˆReact 16.8+ï¼‰ï¼š

  ```jsx
  const context = useContext(UserContext);
  if (!context) throw new Error("å¿…é¡»åœ¨ Provider å†…ä½¿ç”¨è¯¥ Hook");
  ```

---

### âœ… æ€»ç»“

| æƒ…å†µ                          | ç»“æœ                                     |
| --------------------------- | -------------------------------------- |
| `Consumer` æ‰¾åˆ°æœ€è¿‘çš„ `Provider` | ä½¿ç”¨å…¶ `value`                            |
| æ²¡æœ‰æ‰¾åˆ° `Provider`             | ä½¿ç”¨ `createContext(defaultValue)` ä¸­çš„é»˜è®¤å€¼ |
| é»˜è®¤å€¼ä¸º `null` æˆ–æ ‡å¿—ä½            | å¯æ‰‹åŠ¨æŠ¥é”™æˆ–æ˜¾ç¤º fallback                      |

---

`useContext` æ˜¯ React åœ¨ 16.8 å¼•å…¥çš„ä¸€ä¸ª Hookï¼Œç”¨æ¥åœ¨å‡½æ•°ç»„ä»¶ä¸­è¯»å– context çš„å€¼ï¼Œå®ƒæ˜¯å¯¹ä¼ ç»Ÿ `<Context.Consumer>` å†™æ³•çš„ç®€æ´æ›¿ä»£æ–¹æ¡ˆã€‚

---

## âœ… `useContext` çš„åŸºæœ¬ç”¨æ³•

```jsx
const ThemeContext = React.createContext('light');

function ThemedButton() {
  const theme = useContext(ThemeContext);
  return <button className={theme}>æŒ‰é’®</button>;
}
```

### ğŸ‘†ä¸Šé¢è¿™ä¸ªä¾‹å­è¯´æ˜ï¼š

* `useContext(ThemeContext)` è·å–æœ€è¿‘çš„ `ThemeContext.Provider` æä¾›çš„å€¼ã€‚
* å¦‚æœç»„ä»¶æ ‘ä¸­æ²¡æœ‰å¯¹åº”çš„ `Provider`ï¼Œåˆ™ä½¿ç”¨ `createContext()` æ—¶å®šä¹‰çš„é»˜è®¤å€¼ `'light'`ã€‚

---

## ğŸ“Œ è¯­æ³•

```js
const value = useContext(MyContext)
```

* **å‚æ•°**ï¼šä¸€ä¸ªç”± `React.createContext()` åˆ›å»ºçš„ Context å¯¹è±¡ã€‚
* **è¿”å›å€¼**ï¼šå½“å‰ context çš„å€¼ï¼ˆå¯èƒ½æ¥è‡ª Providerï¼Œä¹Ÿå¯èƒ½æ˜¯é»˜è®¤å€¼ï¼‰ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **åªèƒ½åœ¨å‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰ Hook ä¸­ä½¿ç”¨**

`useContext` ä¸èƒ½åœ¨ class ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œå®ƒåªèƒ½ç”¨äºï¼š

* å‡½æ•°ç»„ä»¶
* è‡ªå®šä¹‰ Hook

### 2. **å§‹ç»ˆè®¢é˜…ä¸Šä¸‹æ–‡å˜åŒ–**

ä½¿ç”¨ `useContext` çš„ç»„ä»¶ä¼šåœ¨ context å€¼å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿è¿™ä¸ªå€¼åœ¨ç»“æ„ä¸Šæ˜¯ä¸€æ ·çš„ï¼ˆå¼•ç”¨å˜äº†ï¼‰ã€‚

```jsx
const ThemeContext = React.createContext('light');

function App() {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={theme}>
      <ThemedButton />
    </ThemeContext.Provider>
  );
}
```

æ¯æ¬¡ `setTheme` æ‰§è¡Œï¼Œå³ä½¿å€¼æ˜¯ç›¸åŒçš„å­—ç¬¦ä¸² `'light'`ï¼Œ`ThemedButton` ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚

### 3. **ä¸èƒ½é€‰æ‹©æ€§åœ°ç›‘å¬éƒ¨åˆ† context å€¼**

ä¸åƒ Redux çš„ `connect` æˆ– Zustand é‚£æ ·æ”¯æŒ"é€‰æ‹©æ€§è®¢é˜…"ï¼Œ`useContext` æ˜¯å…¨å€¼è®¢é˜…ï¼Œä»»ä½•å˜åŒ–éƒ½ä¼šè§¦å‘ä½¿ç”¨å®ƒçš„ç»„ä»¶æ›´æ–°ã€‚

### 4. **é¿å…ä¸åœ¨ Provider ä¸­ä½¿ç”¨æ—¶çš„è¯¯ç”¨**

ä½ å¯ä»¥åœ¨å–å€¼æ—¶æ£€æµ‹æ˜¯å¦ä¸º `undefined` æˆ– `null` æ¥æé†’å¼€å‘è€…ï¼š

```jsx
const UserContext = React.createContext(undefined);

function useUser() {
  const user = useContext(UserContext);
  if (!user) throw new Error("useUser å¿…é¡»åœ¨ <UserProvider> å†…ä½¿ç”¨");
  return user;
}
```

---

## ğŸš€ ä¸ `<Consumer>` å¯¹æ¯”

| å¯¹æ¯”é¡¹  | `<Consumer>` | `useContext` |
| ---- | ------------ | ------------ |
| ä½¿ç”¨æ–¹å¼ | JSX ç»“æ„åµŒå¥—     | å‡½æ•°å†…ç›´æ¥è°ƒç”¨      |
| å†™æ³•   | å‡½æ•°ä½œä¸ºå­èŠ‚ç‚¹      | æ™®é€šå˜é‡èµ‹å€¼       |
| ç»„ä»¶ç±»å‹ | ç±»/å‡½æ•°éƒ½å¯ç”¨      | ä»…é™å‡½æ•°ç»„ä»¶       |
| å¯è¯»æ€§  | åµŒå¥—è¾ƒæ·±ï¼Œç¹ç      | ç®€æ´ã€ç›´è§‚        |
| ä¾èµ–æ›´æ–° | è‡ªåŠ¨è®¢é˜…æ›´æ–°       | åŒæ ·è‡ªåŠ¨è®¢é˜…       |

**æ¨èï¼š** é™¤éä½ åœ¨å†™ class ç»„ä»¶ï¼Œä¸€èˆ¬éƒ½åº”ä½¿ç”¨ `useContext`ã€‚

---

## ğŸ›  ç¤ºä¾‹ï¼šå°è£… Provider + useContext Hook

```jsx
// UserContext.js
const UserContext = React.createContext();

export function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  return (
    <UserContext.Provider value={{ user, setUser }}>
      {children}
    </UserContext.Provider>
  );
}

export function useUser() {
  const context = useContext(UserContext);
  if (!context) throw new Error("useUser å¿…é¡»åœ¨ UserProvider ä¸­ä½¿ç”¨");
  return context;
}
```

è¿™æ ·å¯ä»¥ç®€åŒ–åœ¨ç»„ä»¶ä¸­çš„ä½¿ç”¨ï¼š

```jsx
function Profile() {
  const { user } = useUser();
  return <div>æ¬¢è¿ {user.name}</div>;
}
```

---

## âœ… æ€»ç»“

| ç‰¹æ€§   | è¯´æ˜                                  |
| ---- | ----------------------------------- |
| åŠŸèƒ½   | è¯»å–æœ€è¿‘çš„ Provider æä¾›çš„ context å€¼        |
| ä¼˜ç‚¹   | ç®€æ´ã€ç›´æ¥ã€è‡ªåŠ¨è®¢é˜…æ›´æ–°                        |
| ä½¿ç”¨æ¡ä»¶ | åªèƒ½åœ¨å‡½æ•°ç»„ä»¶æˆ– Hook ä¸­ä½¿ç”¨                   |
| é”™è¯¯å¤„ç† | å¯ç»“åˆè‡ªå®šä¹‰ Hook æ·»åŠ æ ¡éªŒé€»è¾‘                  |
| æ›¿ä»£æ–¹æ¡ˆ | `<Context.Consumer>`ï¼ˆä¸æ¨èï¼Œé™¤éç”¨ classï¼‰ |

å¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£ context æ€§èƒ½ä¼˜åŒ–ã€è·¨å¤šä¸ª context åˆå¹¶ä½¿ç”¨ã€æˆ–ç»“åˆ Reduxã€Zustandã€Recoil çš„æ–¹æ¡ˆï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»§ç»­è®²ã€‚

