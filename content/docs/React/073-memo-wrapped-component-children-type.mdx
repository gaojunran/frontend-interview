---
title: ä¸ºä»€ä¹ˆä½¿ç”¨ React.memo å’Œ React.forwardRef åŒ…è£…çš„ç»„ä»¶ä¼šæç¤º children ç±»å‹ä¸åŒ¹é…ï¼Ÿ
---

è¿™ä¸ªé—®é¢˜å¸¸è§äº **ä½¿ç”¨ TypeScript çš„ React é¡¹ç›®**ä¸­ï¼Œé”™è¯¯ç±»ä¼¼äºï¼š

```
Type '{ children: ReactNode; ... }' is not assignable to type ...
```

æ ¹æœ¬åŸå› æ˜¯ï¼š

> **åœ¨ä½¿ç”¨ `React.memo` å’Œ `React.forwardRef` ç»„åˆåŒ…è£…ç»„ä»¶æ—¶ï¼Œç±»å‹ä¿¡æ¯å¦‚æœæ²¡æ­£ç¡®ä¼ é€’ï¼ŒTypeScript æ— æ³•æ¨æ–­ `children` ç±»å‹ï¼Œæˆ–è€…æ— æ³•è¯†åˆ« `ref`ï¼Œå¯¼è‡´ç±»å‹ä¸åŒ¹é…é”™è¯¯ã€‚**

---

## ä¸€ã€é—®é¢˜é‡ç°ç¤ºä¾‹

### åŸç»„ä»¶å†™æ³•ï¼š

```tsx
type MyComponentProps = {
  children?: React.ReactNode;
};

const MyComponent = (props: MyComponentProps, ref: React.Ref<HTMLDivElement>) => {
  return <div ref={ref}>{props.children}</div>;
};

export default React.memo(React.forwardRef(MyComponent));
```

### ä½¿ç”¨ç»„ä»¶æ—¶ï¼š

```tsx
<MyComponent>
  <p>Hello</p>
</MyComponent>
```

ğŸš« æŠ¥é”™ï¼ˆchildren ç±»å‹ä¸åŒ¹é…ï¼‰

---

## äºŒã€åŸå› è§£æ

### âœ… `React.forwardRef` ä¼šæ”¹å˜ç»„ä»¶ç±»å‹ï¼š

```ts
const Forwarded = React.forwardRef(MyComponent);
```

å®ƒè¿”å›çš„æ˜¯ `ForwardRefExoticComponent<Props & RefAttributes<T>>`

### âŒ `React.memo` é»˜è®¤æ— æ³•è‡ªåŠ¨æ¨æ–­ forwardRef åçš„æ³›å‹

å½“ä½ è¿™æ ·å†™æ—¶ï¼š

```ts
export default React.memo(React.forwardRef(MyComponent));
```

ç”±äº `memo` æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šæ³›å‹ä¿¡æ¯ï¼ŒTypeScript æ— æ³•æ­£ç¡®ä¿ç•™ `children` æˆ– `ref` çš„ç±»å‹ä¿¡æ¯ã€‚

---

## ä¸‰ã€æ­£ç¡®å†™æ³•ï¼ˆæ˜¾å¼æŒ‡å®šç±»å‹ï¼‰

### âœ… æ–¹å¼ 1ï¼šæ‹†åˆ†ä¸­é—´å˜é‡ï¼Œæ˜ç¡®ç±»å‹

```tsx
import React, { forwardRef, memo, ReactNode } from 'react';

type MyComponentProps = {
  children?: ReactNode;
};

const MyComponent = (
  props: MyComponentProps,
  ref: React.Ref<HTMLDivElement>
) => {
  return <div ref={ref}>{props.children}</div>;
};

const Forwarded = forwardRef<HTMLDivElement, MyComponentProps>(MyComponent);

export default memo(Forwarded);
```

è¿™é‡Œçš„å…³é”®æ˜¯ï¼š

```ts
forwardRef<HTMLDivElement, MyComponentProps>
```

æ˜¾å¼æŒ‡å®š ref å’Œ props ç±»å‹ï¼ŒTypeScript å°±ä¸ä¼šä¸¢å¤±ç±»å‹ä¿¡æ¯ã€‚

---

## å››ã€æ¨èå†™æ³•æ€»ç»“

| å†™æ³•                                         | æ˜¯å¦æ¨è | åŸå›                      |
| ------------------------------------------ | ---- | ---------------------- |
| `memo(forwardRef(fn))` ä¸åŠ ç±»å‹                | âŒ    | ç±»å‹ä¸¢å¤±ï¼Œchildren/ref è¯†åˆ«é”™è¯¯ |
| æ‹†æˆä¸¤æ­¥ï¼š`const A = forwardRef...` å† `memo(A)` | âœ…    | ç±»å‹æ¸…æ™°ï¼Œchildren/ref æ­£ç¡®æ¨æ–­ |
| ä½¿ç”¨æ³›å‹å‚æ•° `<T, P>` æ˜ç¡®ç±»å‹                       | âœ…    | æé«˜å¯è¯»æ€§å’Œç±»å‹å®‰å…¨             |

---

## äº”ã€å°ç»“

* `forwardRef` å’Œ `memo` éƒ½æ˜¯é«˜é˜¶ç»„ä»¶ï¼Œç±»å‹åŒ…è£…æ¯”è¾ƒæ·±ã€‚
* é»˜è®¤å†™æ³• TypeScript æ— æ³•è‡ªåŠ¨ä¿ç•™ç±»å‹ä¿¡æ¯ã€‚
* è¦è§£å†³ `children` æˆ– `ref` ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œ**å¿…é¡»æ˜¾å¼æŒ‡å®šæ³›å‹ç±»å‹**ã€‚
* æ¨èå°† `forwardRef` å’Œ `memo` æ‹†å¼€å†™ï¼Œå¢å¼ºç±»å‹æ¨æ–­èƒ½åŠ›ã€‚

---

`React.forwardRef` çš„ä½œç”¨æ˜¯ï¼š

> **è®©å‡½æ•°ç»„ä»¶æ”¯æŒæ¥æ”¶çˆ¶ç»„ä»¶ä¼ å…¥çš„ `ref`ï¼Œå¹¶å°†å…¶è½¬å‘ï¼ˆforwardï¼‰åˆ°å­ç»„ä»¶å†…éƒ¨çš„æŸä¸ªå®é™… DOM å…ƒç´ æˆ–å­ç»„ä»¶ä¸Šã€‚**

---

## ä¸€ã€èƒŒæ™¯ï¼šå‡½æ•°ç»„ä»¶é»˜è®¤ä¸æ”¯æŒ ref

åœ¨ React ä¸­ï¼Œ`ref` æ˜¯ç”¨æ¥è®¿é—® DOM æˆ–ç»„ä»¶å®ä¾‹çš„ã€‚æ¯”å¦‚ï¼š

```tsx
const inputRef = useRef(null);

return <input ref={inputRef} />;
```

è¿™ä¸ªå¯ä»¥è®¿é—® `<input>` DOMã€‚ä½†å¦‚æœä½ å†™äº†ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ç»„ä»¶ï¼š

```tsx
const MyInput = () => <input />;

// é”™è¯¯ï¼šå‡½æ•°ç»„ä»¶ä¸èƒ½æ¥æ”¶ ref
<MyInput ref={someRef} /> âŒ
```

å‡½æ•°ç»„ä»¶é»˜è®¤ **ä¸èƒ½æ¥æ”¶ `ref`**ï¼Œå› ä¸ºå®ƒä¸æ˜¯ç±»ç»„ä»¶ã€ä¹Ÿæ²¡æœ‰å®ä¾‹ã€‚

---

## äºŒã€`forwardRef` çš„ä½œç”¨ï¼šè®©å‡½æ•°ç»„ä»¶ä¹Ÿèƒ½æ¥æ”¶ `ref`

ä½¿ç”¨ `forwardRef`ï¼Œä½ å¯ä»¥å°† ref æ­£ç¡®â€œè½¬å‘â€åˆ°ç»„ä»¶å†…éƒ¨çš„ DOM æˆ–å…¶ä»–ç»„ä»¶ä¸Šã€‚

### âœ… ç¤ºä¾‹ï¼š

```tsx
import React, { forwardRef } from 'react';

const MyInput = forwardRef<HTMLInputElement, {}>((props, ref) => {
  return <input ref={ref} {...props} />;
});

// çˆ¶ç»„ä»¶ä¸­
const App = () => {
  const inputRef = useRef<HTMLInputElement>(null);

  const focusInput = () => {
    inputRef.current?.focus();
  };

  return (
    <>
      <MyInput ref={inputRef} />
      <button onClick={focusInput}>Focus</button>
    </>
  );
};
```

âœ… ç°åœ¨ `ref` èƒ½æ­£å¸¸ä½œç”¨åœ¨ `<input>` ä¸Šï¼Œç‚¹å‡»æŒ‰é’®ä¼šèšç„¦è¾“å…¥æ¡†ã€‚

---

## ä¸‰ã€ä½¿ç”¨åœºæ™¯æ€»ç»“

| åœºæ™¯                                    | æ˜¯å¦é€‚åˆä½¿ç”¨ `forwardRef` |
| ------------------------------------- | ------------------- |
| è‡ªå®šä¹‰ç»„ä»¶éœ€è¦è®©çˆ¶ç»„ä»¶è®¿é—®å†…éƒ¨ DOMï¼ˆå¦‚ `input`, `div`ï¼‰ | âœ… æ˜¯                 |
| å°è£…çš„ UI ç»„ä»¶åº“ç»„ä»¶ï¼ˆå¦‚ `TextField`, `Modal`ï¼‰  | âœ… æ˜¯                 |
| æ— éœ€æ“ä½œ DOM æˆ–ä¸éœ€è¦ ref çš„å±•ç¤ºå‹ç»„ä»¶              | âŒ å¦                 |

---

## å››ã€å’Œ `useImperativeHandle` æ­é…

æœ‰æ—¶å€™ä½ å¸Œæœ›æš´éœ²è‡ªå®šä¹‰çš„å®ä¾‹æ–¹æ³•ï¼ˆè€Œä¸ä»…ä»…æ˜¯ DOM å…ƒç´ ï¼‰ï¼Œå¯ä»¥æ­é… `useImperativeHandle` ä½¿ç”¨ï¼š

```tsx
const MyInput = forwardRef((props, ref) => {
  const inputRef = useRef<HTMLInputElement>(null);

  useImperativeHandle(ref, () => ({
    focus: () => inputRef.current?.focus(),
    blur: () => inputRef.current?.blur(),
  }));

  return <input ref={inputRef} />;
});
```

è¿™æ ·ï¼Œçˆ¶ç»„ä»¶å°±å¯ä»¥ä½¿ç”¨ï¼š

```tsx
myInputRef.current.focus(); // è°ƒç”¨æš´éœ²çš„æ–¹æ³•
```

---

## äº”ã€æ€»ç»“ä¸€å¥è¯

> `forwardRef` çš„æœ¬è´¨æ˜¯ï¼š**è®©ä½ å¯ä»¥æŠŠ ref ä¼ å…¥å‡½æ•°ç»„ä»¶ï¼Œå¹¶è½¬å‘åˆ°ç»„ä»¶å†…éƒ¨çš„æŸä¸ªå…ƒç´ æˆ–å­ç»„ä»¶ä¸Šã€‚**

---

å¦‚æœä½ æƒ³çŸ¥é“å®ƒçš„åº•å±‚åŸç†æˆ–å®é™…åº”ç”¨ä¸­çš„æ³¨æ„äº‹é¡¹ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥å±•å¼€è®²è®²ã€‚
