---
title: React é¡¹ç›®å¦‚ä½•å®ç°æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
---

åœ¨ React é¡¹ç›®ä¸­å®ç° **æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSR, Server-Side Renderingï¼‰** çš„ä¸»è¦ç›®çš„æ˜¯æå‡é¦–å±åŠ è½½é€Ÿåº¦ã€æ”¹å–„ SEO å’Œæå‡ç”¨æˆ·ä½“éªŒã€‚ä¸‹é¢è¯¦ç»†è®²è®² SSR æ˜¯ä»€ä¹ˆã€å®ƒçš„åŸç†ã€å®ç°æ–¹å¼ï¼Œä»¥åŠä¸å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰çš„å¯¹æ¯”ã€‚

---

## ä¸€ã€ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Ÿ

æœåŠ¡ç«¯æ¸²æŸ“æŒ‡çš„æ˜¯ï¼š

> **åœ¨æœåŠ¡å™¨ä¸Šå°† React ç»„ä»¶æ¸²æŸ“ä¸º HTML å­—ç¬¦ä¸²ï¼Œç„¶åå‘é€åˆ°æµè§ˆå™¨ï¼Œå†ç”±å®¢æˆ·ç«¯æ¥ç®¡å¹¶å®Œæˆåç»­äº¤äº’é€»è¾‘ï¼ˆç§°ä¸º hydrationï¼‰ã€‚**

ç›¸æ¯”ä¹‹ä¸‹ï¼Œ**å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰** æ˜¯å…ˆå‘é€ä¸€ä¸ªç©ºçš„ HTML é¡µé¢ï¼Œå†åœ¨æµè§ˆå™¨ç«¯é€šè¿‡ JS æ¸²æŸ“ React ç»„ä»¶ã€‚

---

## äºŒã€React SSR çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

React SSR çš„æ ¸å¿ƒæ˜¯ï¼š

1. **åœ¨ Node.js ç¯å¢ƒä¸­è¿è¡Œ React åº”ç”¨**
2. ä½¿ç”¨ React æä¾›çš„ `renderToString` æˆ– `renderToPipeableStream` API
3. å°†ç»„ä»¶æ ‘è½¬ä¸º HTML å­—ç¬¦ä¸²ï¼Œæ’å…¥åˆ°é¡µé¢æ¨¡æ¿ä¸­
4. æŠŠè¿™æ®µå®Œæ•´çš„ HTML è¿”å›ç»™æµè§ˆå™¨
5. æµè§ˆå™¨åŠ è½½ JS bundleï¼Œæ‰§è¡Œ React çš„ `hydrate()` æ¥ç®¡é¡µé¢ï¼Œä½¿ä¹‹å˜ä¸ºå¯äº¤äº’çš„ React åº”ç”¨

---

## ä¸‰ã€SSR çš„æµç¨‹å›¾

```
å®¢æˆ·ç«¯è¯·æ±‚é¡µé¢
     â†“
Node.js æœåŠ¡ç«¯å¤„ç†è·¯ç”±
     â†“
åŠ è½½ React ç»„ä»¶å’Œæ•°æ®
     â†“
ä½¿ç”¨ renderToString æ¸²æŸ“ HTML
     â†“
æ‹¼æ¥ HTML æ¨¡æ¿å¹¶è¿”å›ç»™æµè§ˆå™¨
     â†“
æµè§ˆå™¨æ˜¾ç¤ºé™æ€ HTML é¡µé¢
     â†“
åŠ è½½ JS Bundle å¹¶æ‰§è¡Œ hydrate()
     â†“
React æ¥ç®¡ DOMï¼Œé¡µé¢å˜ä¸ºå¯äº¤äº’
```

---

## å››ã€å¦‚ä½•å®ç° SSRï¼Ÿ

### âœ… ä½¿ç”¨åŸç”Ÿ React + Express ç¤ºä¾‹ï¼š

#### å®‰è£…ä¾èµ–ï¼š

```bash
npm install express react react-dom react-dom/server
```

#### ç›®å½•ç»“æ„ç¤ºæ„ï¼š

```
- server.js          # æœåŠ¡ç«¯å…¥å£
- App.jsx            # React ç»„ä»¶
- index.html         # æ¨¡æ¿
- client.jsx         # å®¢æˆ·ç«¯å…¥å£
```

#### `App.jsx`

```jsx
export default function App() {
  return <div>Hello SSR!</div>;
}
```

#### `server.js`

```js
import express from 'express';
import fs from 'fs';
import path from 'path';
import React from 'react';
import { renderToString } from 'react-dom/server';
import App from './App.jsx';

const app = express();

app.use(express.static('public'));

app.get('*', (req, res) => {
  const appHtml = renderToString(<App />);

  const htmlTemplate = fs.readFileSync('./index.html', 'utf8');
  const finalHtml = htmlTemplate.replace('<!--APP-->', appHtml);

  res.send(finalHtml);
});

app.listen(3000, () => console.log('Server running on http://localhost:3000'));
```

#### `index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><title>SSR</title></head>
<body>
  <div id="root"><!--APP--></div>
  <script src="/client.js"></script>
</body>
</html>
```

#### `client.jsx`

```js
import React from 'react';
import { hydrateRoot } from 'react-dom/client';
import App from './App.jsx';

hydrateRoot(document.getElementById('root'), <App />);
```

> âš ï¸ æ³¨æ„ï¼š`hydrateRoot` æ˜¯ React 18 çš„æ–¹æ³•ï¼Œç”¨äºå°† SSR æ¸²æŸ“çš„ HTML ä¸ React ç»„ä»¶ç»‘å®šèµ·æ¥ã€‚

---

## äº”ã€SSR å¸¸è§æ¡†æ¶

SSR æ¯”è¾ƒå¤æ‚ï¼Œå®é™…é¡¹ç›®ä¸­å¯ä»¥ç”¨æ¡†æ¶ç®€åŒ–ï¼š

| æ¡†æ¶                         | æè¿°                                               |
| -------------------------- | ------------------------------------------------ |
| **Next.js**                | React å®˜æ–¹æ¨èçš„ SSR æ¡†æ¶ï¼Œå¼€ç®±å³ç”¨ï¼Œæ”¯æŒé™æ€ç”Ÿæˆã€åŠ¨æ€è·¯ç”±ã€API routes ç­‰ |
| **Remix**                  | æ›´åå‘äºæœåŠ¡ç«¯çš„æ¸²æŸ“æ–¹å¼ï¼Œå¼ºè°ƒæœåŠ¡ç«¯é©±åŠ¨çš„å¼€å‘ä½“éªŒ                        |
| **Razzle**                 | ç±»ä¼¼äº Create React App çš„ SSR è„šæ‰‹æ¶å·¥å…·                 |
| **React 18 Streaming SSR** | ä½¿ç”¨ `renderToPipeableStream` æ”¯æŒæ¸è¿›å¼ HTML è¾“å‡º        |

---

## å…­ã€SSR çš„ä¼˜ç¼ºç‚¹

### âœ… ä¼˜ç‚¹ï¼š

* æ›´å¿«çš„é¦–å±åŠ è½½ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
* æ›´å¥½çš„ SEOï¼ˆæœç´¢å¼•æ“èƒ½è¯»å– HTML å†…å®¹ï¼‰
* å…¼å®¹æ—§è®¾å¤‡å’Œå¼±ç½‘ç¯å¢ƒ

### âŒ ç¼ºç‚¹ï¼š

* å®ç°å¤æ‚ï¼ˆè·¯ç”±ã€çŠ¶æ€ç®¡ç†ã€æ•°æ®é¢„å–éƒ½è¦é€‚é…ï¼‰
* æœåŠ¡ç«¯å‹åŠ›å¤§ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½è¦ç”Ÿæˆ HTMLï¼‰
* ä¸ CSR æ¶æ„çš„å·®å¼‚éœ€è¦é¢å¤–ç»´æŠ¤ä»£ç 

---

## ä¸ƒã€è¡¥å……ï¼šReact SSR çš„å…³é”® API

| API                        | è¯´æ˜                                    |
| -------------------------- | ------------------------------------- |
| `renderToString()`         | ç”Ÿæˆå®Œæ•´ HTML å­—ç¬¦ä¸²ï¼ˆé˜»å¡å¼ï¼‰                    |
| `renderToNodeStream()`     | ç”Ÿæˆ Node.js Streamï¼Œé€‚åˆå¤§é¡µé¢åˆ†å—å‘é€ï¼ˆReact 17ï¼‰ |
| `renderToPipeableStream()` | React 18 æ–° APIï¼Œæ”¯æŒ Suspense å’Œæµå¼æ¸²æŸ“      |

---

## å…«ã€ä¸ CSR çš„å¯¹æ¯”

| æ–¹é¢    | CSR              | SSR               |
| ----- | ---------------- | ----------------- |
| é¦–å±åŠ è½½  | éœ€è¦ç­‰å¾… JS åŠ è½½å®Œæ‰æ˜¾ç¤ºé¡µé¢ | é¡µé¢åŠ è½½åç«‹å³çœ‹åˆ° HTML å†…å®¹ |
| SEO   | æœç´¢å¼•æ“æŠ“ä¸åˆ°å†…å®¹        | å¯ç›´æ¥æŠ“å– HTML        |
| æœåŠ¡ç«¯å‹åŠ› | å°                | å¤§                 |
| å¼€å‘å¤æ‚åº¦ | ä½                | é«˜                 |

---

## ä¹ã€æ€»ç»“ä¸€å¥è¯ï¼š

> SSR æ˜¯å°† React æ¸²æŸ“æå‰åˆ°æœåŠ¡ç«¯å®Œæˆï¼Œæé«˜é¦–å±é€Ÿåº¦å’Œ SEO æ•ˆæœï¼Œè€Œ React Hydration åˆ™è®©é¡µé¢åœ¨å®¢æˆ·ç«¯å˜å¾—å¯äº¤äº’ã€‚

---

å½“ç„¶å¯ä»¥ã€‚**Next.js** æ˜¯åŸºäº React æ„å»ºçš„ä¸€ä¸ª**å…¨æ ˆæ¡†æ¶**ï¼Œå®ƒçš„æ ¸å¿ƒä¼˜åŠ¿å°±æ˜¯ä¸ºå¼€å‘è€…æä¾›äº†**æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰**ã€**é™æ€ç”Ÿæˆï¼ˆSSGï¼‰**ã€**API è·¯ç”±**ç­‰ç‰¹æ€§ï¼Œè®©ä½ æ— éœ€è‡ªå·±é…ç½®å¤æ‚çš„ Webpackã€Babelã€SSR ç¯å¢ƒå°±èƒ½å¿«é€Ÿå¼€å‘ç°ä»£ Web åº”ç”¨ã€‚

ä¸‹é¢æˆ‘å°†ä»å¤šä¸ªè§’åº¦è¯¦ç»†è®²è®² **Next.js çš„åŸç†å’Œæ ¸å¿ƒè®¾è®¡æ€æƒ³**ã€‚

---

## ğŸ§  ä¸€ã€Next.js çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³

### 1. åŸºäº React æ„å»º

Next.js ä½¿ç”¨ React ä½œä¸ºè§†å›¾åº“ï¼Œä½ å†™çš„æ‰€æœ‰é¡µé¢ç»„ä»¶ä¾ç„¶æ˜¯æ ‡å‡† React ä»£ç ã€‚

### 2. æ–‡ä»¶å°±æ˜¯è·¯ç”±

`pages/` ç›®å½•ä¸‹çš„æ¯ä¸ª `.js` æˆ– `.tsx` æ–‡ä»¶ä¼šè‡ªåŠ¨æˆä¸ºä¸€ä¸ªè·¯ç”±ï¼Œæ— éœ€é…ç½®è·¯ç”±æ–‡ä»¶ã€‚

```bash
/pages
  â”œâ”€â”€ index.js        => /
  â”œâ”€â”€ about.js        => /about
  â””â”€â”€ blog/[id].js    => /blog/123 ï¼ˆåŠ¨æ€è·¯ç”±ï¼‰
```

### 3. æä¾›å¤šç§æ¸²æŸ“æ¨¡å¼

* **SSRï¼ˆServer-Side Renderingï¼‰**
* **SSGï¼ˆStatic Site Generationï¼‰**
* **ISRï¼ˆIncremental Static Regenerationï¼‰**
* **CSRï¼ˆClient-Side Renderingï¼‰**
  è¿™äº›æ¸²æŸ“æ¨¡å¼éƒ½å¯ä»¥åœ¨æ¯ä¸ªé¡µé¢ä¸­æŒ‰éœ€é€‰æ‹©ã€‚

---

## âš™ï¸ äºŒã€Next.js æ¸²æŸ“åŸç†è¯¦è§£

### ğŸ” æ¸²æŸ“æœºåˆ¶å¯¹æ¯”

| æ¨¡å¼  | æ•°æ®è·å–å‡½æ•°                        | æ¸²æŸ“æ—¶æœº         | ä½¿ç”¨åœºæ™¯         |
| --- | ----------------------------- | ------------ | ------------ |
| SSG | `getStaticProps`              | æ„å»ºæ—¶ç”Ÿæˆé™æ€ HTML | åšå®¢ã€æ–‡æ¡£ç­‰ä¸å˜å†…å®¹   |
| SSR | `getServerSideProps`          | æ¯æ¬¡è¯·æ±‚æ—¶ç”Ÿæˆ HTML | ç”¨æˆ·ä¸ªæ€§åŒ–é¡µé¢      |
| CSR | `useEffect + fetch`           | æµè§ˆå™¨ç«¯æ¸²æŸ“       | ä¸éœ€ SEO çš„å†…å®¹   |
| ISR | `getStaticProps + revalidate` | æ„å»ºååå°è‡ªåŠ¨æ›´æ–°    | æ–°é—»ã€å•†å“é¡µç­‰éœ€å®šæœŸåˆ·æ–° |

---

### 1ï¸âƒ£ SSR åŸç†ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰

åœ¨é¡µé¢æ–‡ä»¶ä¸­ä½¿ç”¨ `getServerSideProps`ï¼š

```js
export async function getServerSideProps(context) {
  const data = await fetchData();
  return { props: { data } };
}
```

* è¯¥å‡½æ•°è¿è¡Œåœ¨ **Node.js æœåŠ¡ç«¯**
* æ¯æ¬¡è¯·æ±‚é¡µé¢éƒ½ä¼šé‡æ–°æ‰§è¡Œè¿™ä¸ªå‡½æ•°
* ç„¶åç”±æœåŠ¡å™¨ä½¿ç”¨ `renderToPipeableStream()` æ¸²æŸ“ HTML
* æŠŠ HTML è¿”å›æµè§ˆå™¨ï¼Œå®¢æˆ·ç«¯å†ç”¨ `hydrate()` æ¥ç®¡é¡µé¢

---

### 2ï¸âƒ£ SSG åŸç†ï¼ˆé™æ€ç”Ÿæˆï¼‰

```js
export async function getStaticProps() {
  const data = await fetchData();
  return { props: { data } };
}
```

* åœ¨æ„å»ºæ—¶è¿è¡Œ
* å°†ç»„ä»¶æ¸²æŸ“ä¸º HTML + JSONï¼ˆç”¨äº hydrationï¼‰
* ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œéƒ¨ç½²åä¸éœ€è¦æœåŠ¡å™¨æ¸²æŸ“

é™æ€ç”Ÿæˆåçš„ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š

```
.out/
  â””â”€â”€ index.html
  â””â”€â”€ _next/data/build-id/index.json
```

---

### 3ï¸âƒ£ ISR åŸç†ï¼ˆå¢é‡é™æ€ç”Ÿæˆï¼‰

```js
export async function getStaticProps() {
  const data = await fetchData();
  return {
    props: { data },
    revalidate: 60, // æ¯ 60 ç§’æœ€å¤šæ›´æ–°ä¸€æ¬¡
  };
}
```

* æ„å»ºæ—¶ç”Ÿæˆé™æ€ HTML
* æµè§ˆå™¨è®¿é—®åï¼Œè‹¥é¡µé¢å·²è¿‡æœŸï¼Œåˆ™åå°å¼‚æ­¥å†ç”Ÿæˆä¸€æ¬¡æ–° HTML
* æ— éœ€é‡æ–°æ„å»ºæ•´ä¸ªé¡¹ç›®

---

## ğŸ—ï¸ ä¸‰ã€Next.js çš„æ¶æ„å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰

```
æµè§ˆå™¨è¯·æ±‚ â†’ Next.js Server â†’ 
    æ ¹æ®è·¯ç”±åˆ¤æ–­é¡µé¢ â†’ 
        è°ƒç”¨ getServerSideProps / getStaticProps / API â†’ 
        React æ¸²æŸ“ HTML â†’ 
        è¿”å›é¡µé¢ï¼ˆå« JS bundleï¼‰ â†’ 
        å®¢æˆ·ç«¯ hydrate æ¥ç®¡
```

---

## ğŸ§© å››ã€Next.js çš„é‡è¦ç»„ä»¶å’Œæœºåˆ¶

### 1. **App å’Œ Document**

* `_app.js`: è‡ªå®šä¹‰æ•´ä¸ªåº”ç”¨çš„æ ¹ç»„ä»¶ï¼ˆæ¯”å¦‚æ·»åŠ å¸ƒå±€ã€ä¸»é¢˜ï¼‰
* `_document.js`: ç”¨äºä¿®æ”¹ HTML é¡µé¢ç»“æ„ï¼ˆå¦‚ `<html>`ã€`<head>`ï¼‰

### 2. **API Routes**

åœ¨ `/pages/api/` ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶å°†ä½œä¸º Node.js çš„åç«¯æ¥å£ï¼š

```js
// pages/api/hello.js
export default function handler(req, res) {
  res.status(200).json({ message: 'Hello from API' });
}
```

---

### 3. **Dynamic Routingï¼ˆåŠ¨æ€è·¯ç”±ï¼‰**

ä½¿ç”¨æ–‡ä»¶å `blog/[id].js` å®ç°ï¼š

```js
export async function getStaticPaths() {
  return {
    paths: [{ params: { id: '1' } }],
    fallback: true,
  };
}
```

---

## ğŸ“¦ äº”ã€Next.js çš„æ„å»ºäº§ç‰©

ä½¿ç”¨ `next build` å‘½ä»¤åï¼ŒNext ä¼šè¾“å‡ºï¼š

* `.next/` ç›®å½•ï¼šåŒ…å«æ„å»ºç¼“å­˜ã€HTMLã€é¢„æ¸²æŸ“ JSON æ•°æ®ã€JS/CSS bundle
* `.next/server/`: åŒ…å« SSR é€»è¾‘
* å¯éƒ¨ç½²åˆ° Vercelã€Node.jsã€Edge Functionã€Docker ç­‰ç¯å¢ƒ

---

## âš¡ å…­ã€æ€§èƒ½ä¼˜åŒ–åŸç†

* è‡ªåŠ¨ä»£ç åˆ†å‰²ï¼ˆæŒ‰é¡µåˆ†å‰² JSï¼‰
* Image ä¼˜åŒ–ï¼ˆNext/Imageï¼‰
* è‡ªåŠ¨é™æ€èµ„æºç¼“å­˜
* ä½¿ç”¨ React 18 çš„ Streaming SSR
* æ”¯æŒè¾¹ç¼˜æ¸²æŸ“ï¼ˆEdge Runtimeï¼‰

---

## âœ… ä¸ƒã€æ€»ç»“ä¸€å¥è¯

> **Next.js æ˜¯ä¸º React æä¾›â€œç”Ÿäº§çº§ SSR å’Œé™æ€æ„å»ºèƒ½åŠ›â€çš„å…¨æ ˆæ¡†æ¶ï¼Œå®ƒå¸®ä½ æ‰“é€šä»é¡µé¢å¼€å‘ã€æ•°æ®è·å–åˆ°éƒ¨ç½²çš„æ‰€æœ‰æµç¨‹ã€‚**

